{"remainingRequest":"D:\\ProjectData\\ism\\ism-example\\him-vue-netty\\him-vue-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ProjectData\\ism\\ism-example\\him-vue-netty\\him-vue-master\\src\\components\\Him\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\ProjectData\\ism\\ism-example\\him-vue-netty\\him-vue-master\\src\\components\\Him\\index.vue","mtime":1560643907000},{"path":"D:\\ProjectData\\ism\\ism-example\\him-vue-netty\\him-vue-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1578480813089},{"path":"D:\\ProjectData\\ism\\ism-example\\him-vue-netty\\him-vue-master\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\ProjectData\\ism\\ism-example\\him-vue-netty\\him-vue-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1578480813089},{"path":"D:\\ProjectData\\ism\\ism-example\\him-vue-netty\\him-vue-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// @ is an alias to /src\nimport Cookies from \"js-cookie\";\nimport { userLoginInfo, userQRCheckCode } from \"./api/userIndex\";\nimport { userFriendLists } from \"./api/userFriend\";\nimport { userLoginByTourist, userLoginByQq } from \"./api/userLogin\";\nimport {\n    userFriendMsgClearUnMsgCount,\n    userFriendMsgCreate,\n    userFriendMsgLists\n} from \"./api/userFriendMsg\";\nimport {\n    userFriendAskAck,\n    userFriendAskClearFriendAskCount,\n    userFriendAskCreate,\n    userFriendAskLists\n} from \"./api/userFriendAsk\";\nimport { userGroupCreate, userGroupLists } from \"./api/userGroup\";\nimport {\n    userGroupUserCheckCode,\n    userGroupUserClearUnMsgCount,\n    userGroupUserCreate,\n    userGroupUserDelete,\n    userGroupUserLists,\n    userGroupUserUpdate\n} from \"./api/userGroupUser\";\nimport { userGroupMsgCreate, userGroupMsgLists } from \"./api/userGroupMsg\";\n\nlet QRCode = require(\"qrcode\");\nexport default {\n    name: \"Him\",\n    props: {\n        isShow: {\n            type: Boolean,\n            default: true\n        },\n        width: {\n            type: String,\n            default: \"100%\"\n        },\n        height: {\n            type: String,\n            default: \"100%\"\n        },\n        top: String,\n        left: String,\n        bottom: String,\n        right: String,\n        apiBaseUrl: String,\n        webSocketUrl: String,\n        userQRCodeUrl: String, // 用户二维码的生成地址\n        groupQRCodeUrl: String, // 群二维码的生成地址\n        // 是否自动初始化\n        isAutoInit: {\n            type: Boolean,\n            default: true\n        },\n        // 尝试重新连接的最大次数\n        webSocketReconnectMaxCount: {\n            type: Number,\n            default: 5\n        },\n        // WebSocket 编码\n        WSResEncode: {\n            type: Function,\n            default: function(data) {\n                return JSON.stringify(data);\n            }\n        },\n        // WebSocket 编码\n        WSResDecode: {\n            type: Function,\n            default: function(data) {\n                return JSON.parse(data);\n            }\n        }\n    },\n    data() {\n        return {\n            themeList: [\n                {\n                    \"background-image\":\n                        \"url(\" + require(\"./image/bg-1.jpg\") + \")\",\n                    \"background-repeat\": \"no-repeat\",\n                    \"background-size\": \"cover\",\n                    \"background-color\": \"#f6f6f6\"\n                },\n                {\n                    \"background-image\":\n                        \"url(\" + require(\"./image/bg-2.jpg\") + \")\",\n                    \"background-repeat\": \"no-repeat\",\n                    \"background-size\": \"cover\",\n                    \"background-color\": \"#f6f6f6\"\n                },\n                {\n                    \"background-image\":\n                        \"url(\" + require(\"./image/bg-3.jpg\") + \")\",\n                    \"background-repeat\": \"no-repeat\",\n                    \"background-size\": \"cover\",\n                    \"background-color\": \"#f6f6f6\"\n                },\n                {\n                    \"background-image\":\n                        \"url(\" + require(\"./image/bg-4.jpg\") + \")\",\n                    \"background-repeat\": \"no-repeat\",\n                    \"background-size\": \"cover\",\n                    \"background-color\": \"#f6f6f6\"\n                },\n                {\n                    \"background-image\":\n                        \"url(\" + require(\"./image/bg-5.jpg\") + \")\",\n                    \"background-repeat\": \"no-repeat\",\n                    \"background-size\": \"cover\",\n                    \"background-color\": \"#f6f6f6\"\n                },\n                {\n                    \"background-repeat\": \"no-repeat\",\n                    \"background-size\": \"cover\",\n                    \"background-color\": \"#f6f6f6\"\n                }\n            ],\n            themeSelected: {\n                \"background-repeat\": \"no-repeat\",\n                \"background-size\": \"cover\",\n                \"background-color\": \"#f6f6f6\"\n            },\n            themeVisible: false,\n            imTabList: [\n                {\n                    index: 0,\n                    isSelected: true,\n                    title: \"消息\"\n                },\n                {\n                    index: 1,\n                    isSelected: false,\n                    title: \"朋友\"\n                },\n                {\n                    index: 2,\n                    isSelected: false,\n                    title: \"群组\"\n                }\n            ],\n            imTabSelectedIndex: 0, // 选中的index\n            userQRCodeImg: null,\n            userQRCodeVisible: false,\n            groupQRCodeImg: null,\n            groupQRCodeVisible: false,\n            isMove: false,\n            clientWidth: null,\n            clientHeight: null,\n            user: {\n                profile: {},\n                sid: null\n            },\n            imBoxPositionX: null,\n            imBoxPositionY: null,\n            userFriendList: {},\n            userFriendListLimit: 500, // 每次拉取多少好友\n            newFriendVisible: false,\n            newFriendQuery: {\n                page: 1,\n                limit: 20\n            },\n            newFriendList: [],\n            newFriendLoading: false,\n            newFriendLoadMore: true, // 是否还可以加载更多\n            userGroupList: {}, // 群列表\n            userGroupListLimit: 500, // 群列表每次拉取\n            historyMsgList: {},\n            historyMsgListSelected: {}, // 历史消息的选中值\n            createGroupName: \"\",\n            createGroupVisible: false,\n            chatVisible: false,\n            emojiList: [\n                {\n                    title: \"微笑\",\n                    code: \"smile\"\n                },\n                {\n                    title: \"发笑\",\n                    code: \"laughing\"\n                },\n                {\n                    title: \"害羞\",\n                    code: \"blush\"\n                },\n                {\n                    title: \"心眼\",\n                    code: \"heart_eyes\"\n                },\n                {\n                    title: \"傻笑\",\n                    code: \"smirk\"\n                },\n                {\n                    title: \"激动\",\n                    code: \"flushed\"\n                },\n                {\n                    title: \"咧嘴\",\n                    code: \"grin\"\n                },\n                {\n                    title: \"亲亲\",\n                    code: \"kissing_smiling_eyes\"\n                },\n                {\n                    title: \"眨眼\",\n                    code: \"wink\"\n                },\n                {\n                    title: \"害羞的亲亲\",\n                    code: \"kissing_closed_eyes\"\n                },\n                {\n                    title: \"调皮\",\n                    code: \"stuck_out_tongue_winking_eye\"\n                },\n                {\n                    title: \"晚安\",\n                    code: \"sleeping\"\n                },\n                {\n                    title: \"担心\",\n                    code: \"worried\"\n                },\n                {\n                    title: \"激动的微信\",\n                    code: \"sweat_smile\"\n                },\n                {\n                    title: \"冷汗\",\n                    code: \"cold_sweat\"\n                },\n                {\n                    title: \"笑哭\",\n                    code: \"joy\"\n                },\n                {\n                    title: \"哭泣\",\n                    code: \"sob\"\n                },\n                {\n                    title: \"愤怒\",\n                    code: \"angry\"\n                },\n                {\n                    title: \"生病\",\n                    code: \"mask\"\n                },\n                {\n                    title: \"尖叫\",\n                    code: \"scream\"\n                },\n                {\n                    title: \"墨镜\",\n                    code: \"sunglasses\"\n                },\n                {\n                    title: \"缩略图\",\n                    code: \"thumbsup\"\n                },\n                {\n                    title: \"鼓掌\",\n                    code: \"clap\"\n                },\n                {\n                    title: \"OK\",\n                    code: \"ok_hand\"\n                }\n            ],\n            emojiVisible: false,\n            chatUser: {},\n            chatTextFocus: false,\n            chatCount: 0, // 当前窗口收到的消息总量\n            chatText: \"\",\n            chatMsgListPositionX: null,\n            chatMsgListPositionY: null,\n            chatMsgList: [],\n            chatMsgListFriendQuery: {\n                senderUid: null,\n                page: 1,\n                limit: 25\n            },\n            chatMsgListGroupQuery: {\n                groupId: null,\n                page: 1,\n                limit: 25\n            },\n            chatMsgGroupUserList: {},\n            chatMsgGroupUserVisible: false,\n            chatMsgListScrollTop: true,\n            chatMsgListHandleLoading: false,\n            chatMsgListHandleMoreText: \"\",\n            chatMaxCount: 1, // 最大消息数, 用作有多少条消息就 ack 一次, 后期可以做成定时器\n            webSocket: null,\n            webSocketReconnectCount: 0,\n            webSocketIsReconnect: true, // 是否重连\n            webSocketWarningText:\n                \"连接断开,正在尝试重连 <i class='dotting'></i>\",\n            webSocketIsOpen: false,\n            // 心跳定时器\n            webSocketPingTimer: null,\n            webSocketPingTime: 10000, // 心跳的间隔，当前为 10秒,\n            confirm: {\n                isShow: false, // 是否显示\n                title: \"提示\", // 标题\n                message: \"确定执行吗?\", // 标题\n                okHandle: function() {}, // 确认的回调\n                okName: \"确认\", // 确认按钮的名称\n                cancelHandle: function() {}, // 取消的回调\n                cancelName: \"取消\" // 取消按钮的名称\n            }\n        };\n    },\n    methods: {\n        // 输入框的失去焦点事件, 解决微信中的bug\n        chatTextBlur() {\n            window.scroll(0, 0);\n        },\n        // 判断字符是否为空的方法\n        isEmpty(obj) {\n            return (\n                !obj || typeof obj === \"undefined\" || obj === null || obj === \"\"\n            );\n        },\n        // 设置 登录用户ID\n        setUid(value) {\n            Cookies.set(\"UID\", value, {\n                expires: 365,\n                path: \"/\"\n            });\n        },\n        getUid() {\n            let uid = Cookies.get(\"UID\", {\n                path: \"/\"\n            });\n            if (this.isEmpty(uid)) {\n                return null;\n            }\n            return uid;\n        },\n        delUid() {\n            Cookies.remove(\"UID\", {\n                path: \"/\"\n            });\n        },\n        setSid(value) {\n            Cookies.set(\"SID\", value, {\n                expires: 365,\n                path: \"/\"\n            });\n        },\n        getSid() {\n            let sid = Cookies.get(\"SID\", {\n                path: \"/\"\n            });\n            if (this.isEmpty(sid)) {\n                return null;\n            }\n            return sid;\n        },\n        delSid() {\n            Cookies.remove(\"SID\", {\n                path: \"/\"\n            });\n        },\n        setLocalStorage(name, value) {\n            localStorage.setItem(name, value);\n        },\n        getLocalStorage(name) {\n            return localStorage.getItem(name);\n        },\n        // 点击切换主题\n        changeTheme(index, isLocalStorage) {\n            // 判断是否存在下标\n            if (\n                index === null ||\n                index < 0 ||\n                this.themeList.length === 0 ||\n                index >= this.themeList.length\n            ) {\n                return false;\n            }\n            let themeSelected = this.themeList[index];\n            if (themeSelected) {\n                this.themeSelected = themeSelected;\n                if (isLocalStorage === true) {\n                    this.setLocalStorage(\"themSelectedIndex\", index);\n                }\n            }\n        },\n        // 点击了 QQ 登录\n        qqLoginClick() {\n            // 传递到父组件\n            this.$emit(\"on-qq-login-click\");\n        },\n        // im-box 的询问框\n        confirmInit(\n            title,\n            message,\n            okHandle,\n            cancelHandle,\n            okName,\n            cancelName\n        ) {\n            this.confirm.isShow = true;\n            this.confirm.title = title;\n            this.confirm.message = message;\n            this.confirm.okHandle = okHandle;\n            this.confirm.cancelHandle = cancelHandle;\n            if (okName) {\n                this.confirm.okName = okName;\n            }\n            if (cancelName) {\n                this.confirm.cancelName = cancelName;\n            }\n        },\n        userOutClick() {\n            this.confirmInit(\n                \"提示\",\n                \"确定登出吗?\",\n                () => {\n                    // 确定了\n                    this.userOut();\n                },\n                () => {\n                    // 取消了登出\n                    this.confirm.isShow = false;\n                }\n            );\n        },\n        // 登出\n        userOut() {\n            this.delUid();\n            this.delSid();\n            this.user = {\n                profile: {},\n                sid: null\n            };\n            this.userFriendList = {};\n            this.newFriendList = [];\n            this.userGroupList = {};\n            this.historyMsgList = {};\n            this.historyMsgListSelected = {};\n            this.chatMsgList = [];\n            this.chatMsgGroupUserList = {};\n            this.chatCount = 0;\n            this.userQRCodeImg = null;\n            // 关闭websocket 连接\n            this.wsOut();\n        },\n        // 游客登录\n        touristLogin(sex) {\n            // 先退出\n            this.userOut();\n            userLoginByTourist(this.apiBaseUrl, sex)\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    let data = response.data;\n                    // 设置登录信息\n                    this.setUid(data.uid);\n                    this.setSid(data.sid);\n                    // 登录成功, 重新初始化\n                    this.init();\n                })\n                .catch(() => {});\n        },\n        // QQ 登录\n        qqLogin(code, redirectUri) {\n            this.userOut();\n            userLoginByQq(this.apiBaseUrl, code, redirectUri)\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    let data = response.data;\n                    // 设置登录信息\n                    this.setUid(data.uid);\n                    this.setSid(data.sid);\n                    // 登录成功, 重新初始化\n                    this.init();\n                })\n                .catch(() => {});\n        },\n        // 初始化界面\n        init() {\n            // 初始化主题背景\n            let themSelectedIndex = this.getLocalStorage(\"themSelectedIndex\");\n            this.changeTheme(themSelectedIndex, false);\n            // 初始化用户信息\n            this.userInit();\n            // 打开通知, try 一下, 因为一些浏览器不兼容, 会报错\n            try {\n                var Notification =\n                    window.Notification ||\n                    window.mozNotification ||\n                    window.webkitNotification;\n                // 判断浏览器是否支持桌面通知\n                if (Notification) {\n                    let requestPermission = Notification.requestPermission();\n                    if (requestPermission.then) {\n                        requestPermission.then(function(result) {\n                            // result可能是是granted, denied, 或default.\n                            if (result) {\n                                // console.log(result);\n                            }\n                        });\n                    }\n                }\n            } catch (e) {\n                // console.log(e);\n            }\n        },\n        // 请求错误处理\n        requestErr(code, message) {\n            // 登录失效的\n            if (code === 1) {\n                this.delUid();\n                this.delSid();\n            }\n            // 向父组件传递出去\n            this.$emit(\"on-request-err\", code, message);\n        },\n        userQRCodeClick() {\n            if (this.userQRCodeImg) {\n                this.userQRCodeVisible = true;\n                return false;\n            }\n            userQRCheckCode(this.apiBaseUrl)\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    var opts = {\n                        errorCorrectionLevel: \"H\",\n                        type: \"image/jpeg\",\n                        rendererOpts: {\n                            quality: 0.3\n                        }\n                    };\n                    let qrCodeUrl = this.userQRCodeUrl + response.data;\n                    console.log(qrCodeUrl);\n                    // 生成二维码\n                    QRCode.toDataURL(qrCodeUrl, opts, (error, url) => {\n                        if (error) {\n                            alert(error);\n                            return false;\n                        }\n                        this.userQRCodeVisible = true;\n                        this.userQRCodeImg = url;\n                    });\n                })\n                .catch(() => {});\n        },\n        // 关闭用户二维码\n        userQRCodeCloseHandle() {\n            this.userQRCodeVisible = false;\n        },\n        // 群二维码\n        groupQRCodeClick() {\n            if (this.groupQRCodeImg) {\n                this.groupQRCodeVisible = true;\n                return false;\n            }\n            userGroupUserCheckCode(\n                this.apiBaseUrl,\n                this.historyMsgListSelected.id\n            )\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    var opts = {\n                        errorCorrectionLevel: \"H\",\n                        type: \"image/jpeg\",\n                        rendererOpts: {\n                            quality: 0.3\n                        }\n                    };\n                    let qrCodeUrl = this.groupQRCodeUrl + response.data;\n                    console.log(qrCodeUrl);\n                    // 生成二维码\n                    QRCode.toDataURL(qrCodeUrl, opts, (error, url) => {\n                        if (error) {\n                            alert(error);\n                            return false;\n                        }\n                        this.groupQRCodeVisible = true;\n                        this.groupQRCodeImg = url;\n                    });\n                })\n                .catch(() => {});\n        },\n        // 关闭用户二维码\n        groupQRCodeCloseHandle() {\n            this.groupQRCodeVisible = false;\n        },\n        // 点击下载图片\n        downloadImg(url) {\n            // 生成一个a元素\n            var a = document.createElement(\"a\");\n            // 创建一个单击事件\n            var event = new MouseEvent(\"click\");\n            // 将a的download属性设置为我们想要下载的图片名称，若name不存在则使用‘下载图片名称’作为默认名称\n            a.download = this.user.name;\n            // 将生成的URL设置为a.href属性\n            a.href = url;\n            // 触发a的单击事件\n            a.dispatchEvent(event);\n        },\n        // 去换Tab\n        imTabSelectedHandle(index) {\n            let data = [];\n            for (let item of this.imTabList) {\n                let isSelected = false;\n                if (item.index === index) {\n                    this.imTabSelectedIndex = index;\n                    isSelected = true;\n                }\n                item.isSelected = isSelected;\n                data.push(item);\n            }\n            this.imTabList = data;\n        },\n        msgClearUnMsgCount(type, id) {\n            if (type === 1) {\n                // 清空未读消息数量\n                let query = {\n                    receiverUid: id\n                };\n                userFriendMsgClearUnMsgCount(this.apiBaseUrl, query);\n            } else if (type === 2) {\n                userGroupUserClearUnMsgCount(this.apiBaseUrl, id);\n            }\n        },\n        // 打开聊天界面\n        handleChat(item) {\n            if (item.unMsgCount > 0) {\n                this.msgClearUnMsgCount(item.type, item.id);\n                let key = item.type + \"-\" + item.id;\n                this.historyMsgList[key].unMsgCount = 0;\n            }\n            this.chatVisible = true;\n            this.chatUser = item;\n            this.chatMsgList = [];\n            this.historyMsgListSelected = item;\n            this.chatMsgListFriendQuery.page = 1;\n            this.chatMsgListGroupQuery.page = 1;\n            this.chatMsgGroupUserList = {};\n            // 追加\n            this.getChatMsgList();\n        },\n        // 追加历史消息列表\n        getChatMsgList() {\n            if (this.chatMsgListHandleLoading) {\n                return false;\n            }\n            // 不是第一次加载时\n            if (this.chatMsgList.length !== 0) {\n                this.chatMsgListScrollTop = false;\n            }\n            this.chatMsgListHandleLoading = true;\n            this.chatMsgListHandleMoreText = \"加载中\";\n            let historyItem = this.historyMsgListSelected;\n            let isLoad = true; // 是否是加载更多\n            // 如果是好友类型\n            if (historyItem.type === 1) {\n                let senderUid = historyItem.id;\n                this.chatMsgListFriendQuery.senderUid = historyItem.id;\n                userFriendMsgLists(this.apiBaseUrl, this.chatMsgListFriendQuery)\n                    .then(response => {\n                        this.chatMsgListFriendQuery.page += 1;\n                        this.chatMsgListHandleLoading = false;\n                        if (response.code !== 0) {\n                            this.requestErr(response.code, response.message);\n                            return false;\n                        }\n                        let list = response.data;\n                        if (list.length === 0) {\n                            this.chatMsgListHandleMoreText = \"没有更多了\";\n                            return false;\n                        }\n                        for (let item of list) {\n                            let isMine = this.user.uid === item.senderUid;\n                            let user = {};\n                            if (isMine) {\n                                user = {\n                                    uid: this.user.uid,\n                                    name: this.user.name,\n                                    avatar: this.user.avatar\n                                };\n                            } else {\n                                user = {\n                                    uid: senderUid,\n                                    name: historyItem.name,\n                                    avatar: historyItem.avatar\n                                };\n                            }\n                            // 追加到消息列表\n                            this.pushChatMsgList(\n                                item.msgType,\n                                item.msgContent,\n                                user,\n                                item.createTime,\n                                isLoad\n                            );\n                        }\n                        this.chatMsgListHandleMoreText = \"加载更多消息\";\n                    })\n                    .catch(() => {\n                        this.chatMsgListHandleLoading = false;\n                        this.chatMsgListHandleMoreText = \"\";\n                    });\n            } else if (historyItem.type === 2) {\n                this.chatMsgListGroupQuery.groupId = historyItem.id;\n                userGroupMsgLists(this.apiBaseUrl, this.chatMsgListGroupQuery)\n                    .then(response => {\n                        this.chatMsgListGroupQuery.page += 1;\n                        this.chatMsgListHandleLoading = false;\n                        if (response.code !== 0) {\n                            this.requestErr(response.code, response.message);\n                            return false;\n                        }\n                        let list = response.data;\n                        if (list.length === 0) {\n                            this.chatMsgListHandleMoreText = \"没有更多了\";\n                            return false;\n                        }\n                        for (let item of list) {\n                            // 追加到消息列表\n                            this.pushChatMsgList(\n                                item.msgType,\n                                item.msgContent,\n                                item.user,\n                                item.createTime,\n                                isLoad\n                            );\n                        }\n                        this.chatMsgListHandleMoreText = \"加载更多消息\";\n                    })\n                    .catch(() => {\n                        this.chatMsgListHandleLoading = false;\n                        this.chatMsgListHandleMoreText = \"\";\n                    });\n            }\n        },\n        isShowClick() {\n            // 传递到父组件\n            this.$emit(\"on-is-show-click\");\n        },\n        // 关闭\n        closeChat() {\n            let selectedType = this.historyMsgListSelected.type || 0;\n            let id = this.historyMsgListSelected.id || 0;\n            this.historyMsgListSelected = {};\n            this.chatMsgList = [];\n            this.chatVisible = false;\n            // 清空文本\n            this.chatText = \"\";\n            // 清空群聊的二维码信息\n            this.groupQRCodeImg = null;\n            // 如果有当前窗口有未读消息，清除一下未读消息\n            if (this.chatCount > 0) {\n                this.chatCount = 0;\n                // 清空消息\n                this.msgClearUnMsgCount(selectedType, id);\n            }\n        },\n        // emoji 表情\n        handleEmoji() {\n            this.emojiVisible = !this.emojiVisible;\n        },\n        selectEmoji(item) {\n            this.chatText += \":emoji[\" + item.code + \"]\";\n            this.chatTextFocus = true;\n        },\n        userInit() {\n            if (!this.getUid() || !this.getSid()) {\n                return false;\n            }\n            userLoginInfo(this.apiBaseUrl, {})\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    let data = response.data;\n                    this.user = data;\n                    // 向父组件传递登录初始化完成\n                    this.$emit(\"on-login-init\");\n                    // 递归拉取好友\n                    this.getUserFriendList(1, this.userFriendListLimit);\n                    // 递归拉取群列表\n                    this.getUserGroupList(1, this.userGroupListLimit);\n\n                    // 初始化 WebSocket\n                    this.webSocketInit();\n                })\n                .catch(() => {});\n        },\n        // 获取用户朋友列表\n        getUserFriendList(page, limit) {\n            let query = {\n                page: page,\n                limit: limit\n            };\n            userFriendLists(this.apiBaseUrl, query)\n                .then(response => {\n                    if (response.code !== 0) {\n                        return false;\n                    }\n                    let data = response.data;\n                    if (data.length <= 0) {\n                        return false;\n                    }\n                    let userFriendList = Object.assign({}, this.userFriendList);\n                    for (let item of data) {\n                        // 聊过天\n                        if (item.lastMsgContent) {\n                            this.pushHistoryMsg(\n                                1,\n                                item.user.uid,\n                                item.remark || item.user.name,\n                                item.user.remark,\n                                item.user.avatar,\n                                item.lastMsgContent,\n                                item.unMsgCount,\n                                item.modifiedTime\n                            );\n                        }\n                        userFriendList[item.friendUid] = item;\n                    }\n                    this.userFriendList = userFriendList;\n                    if (data.length < limit) {\n                        return false;\n                    }\n                    this.getUserFriendList(page + 1, limit);\n                })\n                .catch(() => {});\n        },\n        // 朋友列表的点击\n        friendClick(item) {\n            let data = {\n                type: 1,\n                id: item.friendUid,\n                name: item.remark ? item.remark : item.user.name,\n                avatar: item.user.avatar,\n                remark: item.user.remark,\n                unMsgCount: item.unMsgCount ? item.unMsgCount : 0\n            };\n            this.handleChat(data);\n        },\n        // 新的朋友点击\n        newFriendClick() {\n            if (!this.newFriendVisible) {\n                this.newFriendQuery.page = 1;\n                this.newFriendVisible = true;\n                this.newFriendLoadMore = true;\n                this.newFriendList = [];\n                this.getUserFriendAskList();\n                // 清空\n                if (this.user.profile.friendAskCount > 0) {\n                    this.clearFriendAskCount();\n                }\n                return false;\n            }\n            this.newFriendVisible = false;\n        },\n        // 发送好友请求\n        createUserFriendAsk(checkCode, remark) {\n            userFriendAskCreate(this.apiBaseUrl, checkCode, remark)\n                .then(response => {\n                    if (response.code) {\n                        return false;\n                    }\n                })\n                .catch(() => {});\n        },\n        // 确认\n        askAck(item, status) {\n            userFriendAskAck(this.apiBaseUrl, item.id, status)\n                .then(response => {\n                    if (response.code) {\n                        return false;\n                    }\n                    item.status = status;\n                    let userFriendList = Object.assign({}, this.userFriendList);\n                    userFriendList[item.friendUid] = item;\n                    this.userFriendList = userFriendList;\n                    // 追加到历史消息\n                    this.pushHistoryMsg(\n                        1,\n                        item.user.uid,\n                        item.user.name,\n                        item.user.remark,\n                        item.user.avatar,\n                        item.remark ? item.remark : \"成为好友，现在开始聊吧~\",\n                        0,\n                        new Date()\n                    );\n                })\n                .catch(() => {});\n        },\n        // 清空好友请求数量\n        clearFriendAskCount() {\n            userFriendAskClearFriendAskCount(this.apiBaseUrl)\n                .then(response => {\n                    if (response.code) {\n                        return false;\n                    }\n                    this.user.profile.friendAskCount = 0;\n                })\n                .catch(() => {});\n        },\n        // 获取好友请求列表\n        getUserFriendAskList() {\n            if (!this.newFriendLoadMore || this.newFriendLoading) {\n                return false;\n            }\n            this.newFriendLoading = true;\n            userFriendAskLists(this.apiBaseUrl, this.newFriendQuery)\n                .then(response => {\n                    this.newFriendLoading = false;\n                    if (response.code) {\n                        this.newFriendLoadMore = true;\n                        return false;\n                    }\n                    this.newFriendQuery.page += 1;\n                    let data = response.data;\n                    if (data.length === 0) {\n                        this.newFriendLoadMore = false;\n                        return false;\n                    }\n                    if (data.length < this.newFriendQuery.limit) {\n                        this.newFriendLoadMore = false;\n                    }\n                    this.newFriendList = this.newFriendList.concat(data);\n                })\n                .catch(() => {\n                    this.newFriendLoading = false;\n                });\n        },\n        // 获取群列表\n        getUserGroupList(page, limit) {\n            let query = {\n                page: page,\n                limit: limit\n            };\n            userGroupUserLists(this.apiBaseUrl, query)\n                .then(response => {\n                    if (response.code !== 0) {\n                        return false;\n                    }\n                    let data = response.data;\n                    if (data.length <= 0) {\n                        return false;\n                    }\n                    let userGroupList = Object.assign({}, this.userGroupList);\n                    for (let item of data) {\n                        // 聊过天\n                        if (item.lastMsgContent) {\n                            this.pushHistoryMsg(\n                                2,\n                                item.groupId,\n                                item.remark || item.group.name,\n                                item.group.remark,\n                                item.group.avatar,\n                                item.lastMsgContent,\n                                item.unMsgCount,\n                                item.lastMsgTime\n                            );\n                        }\n                        userGroupList[item.groupId] = item;\n                    }\n                    this.userGroupList = userGroupList;\n                    if (data.length < limit) {\n                        return false;\n                    }\n                    this.getUserGroupList(page + 1, limit);\n                })\n                .catch(() => {});\n        },\n        // 群组列表的点击\n        groupClick(item) {\n            let data = {\n                type: 2,\n                id: item.groupId,\n                name: item.group.name,\n                avatar: item.group.avatar,\n                remark: item.group.remark\n            };\n            this.handleChat(data);\n        },\n        // 创建群\n        createGroup() {\n            this.createGroupVisible = true;\n            if (this.createGroupName.length === 0) {\n                return false;\n            }\n            userGroupCreate(this.apiBaseUrl, this.createGroupName, \"\", \"\")\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    let data = response.data;\n                    let userGroupList = Object.assign({}, this.userGroupList);\n                    let item = {\n                        groupId: data.groupId,\n                        group: data\n                    };\n                    userGroupList[item.groupId] = item;\n                    this.userGroupList = userGroupList;\n                    this.createGroupVisible = false;\n                    this.createGroupName = \"\";\n                    // 默认打开群聊天界面\n                    let chatData = {\n                        type: 2,\n                        id: item.groupId,\n                        name: item.group.name,\n                        avatar: item.group.avatar,\n                        remark: item.group.remark\n                    };\n                    this.handleChat(chatData);\n                })\n                .catch(() => {});\n        },\n        // 取消创建群\n        createGroupClose() {\n            this.createGroupVisible = false;\n        },\n        // 加入群\n        joinGroupUser(checkCode) {\n            userGroupUserCreate(this.apiBaseUrl, checkCode)\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    let item = response.data;\n\n                    let userGroupList = Object.assign({}, this.userGroupList);\n                    this.pushHistoryMsg(\n                        2,\n                        item.groupId,\n                        item.remark || item.group.name,\n                        item.group.remark,\n                        item.group.avatar,\n                        item.lastMsgContent,\n                        1,\n                        item.lastMsgTime\n                    );\n                    userGroupList[item.groupId] = item;\n                    this.userGroupList = userGroupList;\n                })\n                .catch(() => {});\n        },\n        // 修改在群的信息\n        updateGroupUser(groupId, remark) {\n            userGroupUserUpdate(this.apiBaseUrl, groupId, remark)\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                })\n                .catch(() => {});\n        },\n        // 删除/退出群\n        outGroupUser(groupId) {\n            userGroupUserDelete(this.apiBaseUrl, groupId)\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    let item = response.data;\n\n                    let userGroupList = Object.assign({}, this.userGroupList);\n                    delete userGroupList[item.groupId];\n                    this.userGroupList = userGroupList;\n                    let historyMsgList = Object.assign({}, this.historyMsgList);\n                    delete historyMsgList[2 + \"-\" + item.groupId];\n                    this.historyMsgList = historyMsgList;\n                })\n                .catch(() => {});\n        },\n        isShowGroupUserListClick() {\n            this.chatMsgGroupUserVisible = !this.chatMsgGroupUserVisible;\n            if (\n                !this.chatMsgGroupUserVisible ||\n                Object.keys(this.chatMsgGroupUserList).length > 0\n            ) {\n                return false;\n            }\n            let query = {\n                groupId: this.historyMsgListSelected.id,\n                page: 1,\n                limit: 500\n            };\n            userGroupLists(this.apiBaseUrl, query)\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    let data = response.data;\n                    let chatMsgGroupUserList = Object.assign(\n                        {},\n                        this.chatMsgGroupUserList\n                    );\n                    for (let item of data) {\n                        chatMsgGroupUserList[item.user.uid] = item;\n                    }\n                    this.chatMsgGroupUserList = chatMsgGroupUserList;\n                })\n                .catch(() => {});\n        },\n        // 追加历史消息 (type: 1:好友,2:群消息)\n        pushHistoryMsg(\n            type,\n            id,\n            name,\n            remark,\n            avatar,\n            lastMsgContent,\n            unMsgCount,\n            modifiedTime\n        ) {\n            let key = type + \"-\" + id;\n            let map = Object.assign({}, this.historyMsgList);\n            let item = map[key];\n            console.log(item, key, \"历史消息\");\n            if (item) {\n                item.lastMsgContent = lastMsgContent;\n                item.unMsgCount += unMsgCount;\n                item.modifiedTime = modifiedTime;\n                map[key] = item;\n                this.historyMsgList = map;\n                return false;\n            }\n            let data = {\n                id: id,\n                type: type,\n                name: name,\n                remark: remark,\n                avatar: avatar,\n                lastMsgContent: lastMsgContent,\n                unMsgCount: unMsgCount,\n                modifiedTime: modifiedTime\n            };\n            map[key] = data;\n            this.historyMsgList = map;\n        },\n        // 追加消息到当前聊天 {isLoad：是否加载更多}\n        pushChatMsgList(msgType, msgContent, user, createTime, isLoad) {\n            msgContent = this.createContent(msgContent);\n            createTime = this.formatDate(createTime, \"yyyy/MM/dd hh:mm:ss\");\n            let item = {};\n            item.isMine = this.user.uid === user.uid;\n            item.user = user;\n            item.msgType = msgType;\n            item.msgContent = msgContent;\n            item.createTime = createTime;\n            // 加载更多，向头部增加\n            if (isLoad) {\n                this.chatMsgList.unshift(item);\n            } else {\n                // 头部尾部增加\n                this.chatMsgList.push(item);\n            }\n        },\n        // 断开连接时\n        webSocketClose() {\n            // 修改状态为未连接\n            this.webSocketIsOpen = false;\n            this.webSocket = null;\n            // 判断是否重连\n            if (\n                this.webSocketIsReconnect &&\n                this.webSocketReconnectCount === 0\n            ) {\n                // 第一次直接尝试重连\n                this.webSocketReconnect();\n            }\n        },\n        // 定时心跳\n        webSocketPing() {\n            this.webSocketPingTimer = setTimeout(() => {\n                if (!this.webSocketIsOpen) {\n                    return false;\n                }\n                console.log(\"心跳\");\n                const payload = {\n                    type: 0\n                };\n                this.webSocketSend(payload);\n                clearTimeout(this.webSocketPingTimer);\n                // 重新执行\n                this.webSocketPing();\n            }, this.webSocketPingTime);\n        },\n        // 初始化 WebSocket\n        webSocketInit() {\n            this.webSocketWarningText =\n                \"连接断开,正在尝试重连 <i class='dotting'></i>\";\n            // 修改是否重连为 true\n            this.webSocketIsReconnect = true;\n            this.webSocket = new WebSocket(this.webSocketUrl);\n            this.webSocket.onopen = this.webSocketHandleOpen;\n            this.webSocket.onerror = this.webSocketHandleError;\n            this.webSocket.onmessage = this.webSocketHandleMessage;\n            this.webSocket.onclose = this.webSocketHandleClose;\n        },\n        // WebSocket 重连\n        webSocketReconnect() {\n            if (this.webSocketIsOpen) {\n                return false;\n            }\n            this.webSocketReconnectCount += 1;\n            // 判断是否到了最大重连次数\n            if (\n                this.webSocketReconnectCount >= this.webSocketReconnectMaxCount\n            ) {\n                this.webSocketWarningText = \"重连次数超限\";\n                return false;\n            }\n            // 初始化\n            this.webSocketInit();\n\n            // 每过 5 秒尝试一次，检查是否连接成功，直到超过最大重连次数\n            let timer = setTimeout(() => {\n                this.webSocketReconnect();\n                clearTimeout(timer);\n            }, 5000);\n        },\n        // WebSocket 打开成功后\n        webSocketHandleOpen() {\n            console.log(\"连接打开\");\n            this.webSocketIsOpen = true;\n            // 清空重连的次数\n            this.webSocketReconnectCount = 0;\n            // 发送登录信息\n            const payload = {\n                type: 1\n            };\n            this.webSocketSend(payload);\n            // 开启定时心跳\n            this.webSocketPing();\n        },\n        // WebSocket 关闭\n        webSocketHandleClose() {\n            console.log(\"连接断开\");\n            // 关闭心跳\n            this.webSocketClose();\n        },\n        // WebSocket 发生错误时\n        webSocketHandleError(err) {\n            console.log(\"连接报错：\", err);\n            // 关闭心跳\n            this.webSocketClose();\n        },\n        // 接收到消息时\n        webSocketHandleMessage(event) {\n            // 响应体的message\n            const data = event.data;\n            this.WSResDecode(data, response => {\n                console.log(\"服务端消息:\", response);\n                let type = response.type || 0;\n                switch (type) {\n                    case -2: // 登录异常\n                        // 退出登录\n                        this.userOut();\n                        break;\n                    case -1: // 异地登录\n                        // 通知下线\n                        this.wsOut();\n                        break;\n                    case 1: // 好友消息\n                        this.wsFriendMsgHandle(response);\n                        break;\n                    case 2: // 群消息\n                    case 5: // 加入群消息\n                        this.wsGroupMsgHandle(response);\n                        break;\n                    case 3: // 好友请求\n                        this.wsFriendAskHandle();\n                        break;\n                    case 4: // 好友同意消息\n                        this.wsFriendAckHandle(response);\n                        break;\n                }\n            });\n        },\n        wsOut() {\n            this.webSocketWarningText = \"异地登录请重新登录\";\n            // 修改重连状态\n            this.webSocketIsReconnect = false;\n            if (this.webSocket) {\n                console.log(\"关闭websocket\");\n                // 关闭 websocket\n                this.webSocket.close();\n            }\n        },\n        // 好友请求\n        wsFriendAskHandle() {\n            this.user.profile.friendAskCount += 1;\n        },\n        // 好友同意消息\n        wsFriendAckHandle(response) {\n            let message = response.message;\n            let user = response.user;\n            let createTime = new Date(response.createTime);\n            let receiveId = message.receiveId || 0;\n            let uid = user.uid || 0;\n            let msgContent = message.msgContent || \"\";\n            if (\n                !receiveId ||\n                typeof receiveId !== \"number\" ||\n                receiveId === 0 ||\n                !msgContent ||\n                msgContent === \"\" ||\n                typeof uid !== \"number\" ||\n                uid === 0\n            ) {\n                return false;\n            }\n            let userFriendList = Object.assign({}, this.userFriendList);\n            let userFriendItem = {\n                friendUid: uid,\n                user: user\n            };\n            userFriendList[uid] = userFriendItem;\n            this.userFriendList = userFriendList;\n            let historyType = 1; // 好友\n            let unMsgCount = 1;\n            // 追加到历史消息\n            this.pushHistoryMsg(\n                historyType,\n                uid,\n                user.name,\n                user.remark,\n                user.avatar,\n                msgContent,\n                unMsgCount,\n                createTime\n            );\n        },\n        // 消息类型的消息（好友消息）\n        wsFriendMsgHandle(response) {\n            let message = response.message;\n            let user = response.user;\n            let createTime = new Date(response.createTime);\n            let receiveId = message.receiveId || 0;\n            let uid = user.uid || 0;\n            let msgType = message.msgType || 0;\n            let msgContent = message.msgContent || \"\";\n            console.log(\"好友消息\", receiveId, msgContent, uid);\n            if (\n                !receiveId ||\n                typeof receiveId !== \"number\" ||\n                receiveId === 0 ||\n                !msgContent ||\n                msgContent === \"\" ||\n                typeof uid !== \"number\" ||\n                uid === 0\n            ) {\n                return false;\n            }\n            let name = user.name;\n            let remark = user.remark;\n            let avatar = user.avatar;\n            // 判断是不是打开的这个对象\n            let selectedType = this.historyMsgListSelected.type || 0;\n            let id = this.historyMsgListSelected.id || 0;\n            let unMsgCount = 1;\n            let historyType = 1;\n            // 判断是不是聊天窗口的消息\n            if (selectedType === historyType && id === uid) {\n                let user = {\n                    uid: uid,\n                    name: name,\n                    avatar: avatar\n                };\n                this.pushChatMsgList(msgType, msgContent, user, createTime);\n                unMsgCount = 0;\n                // 如果超过 1 个消息，则做一次 ACK 消息的操作\n                this.chatCount += 1;\n                if (this.chatCount >= this.chatMaxCount) {\n                    this.chatCount = 0;\n                    // 清空消息\n                    this.msgClearUnMsgCount(historyType, id);\n                }\n            }\n            this.pushHistoryMsg(\n                historyType,\n                uid,\n                name,\n                remark,\n                avatar,\n                msgContent,\n                unMsgCount,\n                createTime\n            );\n        },\n        // 消息类型的消息（群消息）\n        wsGroupMsgHandle(response) {\n            let type = response.type;\n            let message = response.message;\n            let user = response.user;\n            let createTime = new Date(response.createTime);\n            let receiveId = message.receiveId || 0;\n            let uid = user.uid || 0;\n            let msgType = message.msgType || 0;\n            let msgContent = message.msgContent || \"\";\n            console.log(\"群消息\", receiveId, msgContent, uid);\n            if (\n                !receiveId ||\n                typeof receiveId !== \"number\" ||\n                receiveId === 0 ||\n                !msgContent ||\n                msgContent === \"\" ||\n                typeof uid !== \"number\" ||\n                uid === 0\n            ) {\n                return false;\n            }\n            // 如果是入群消息, 则改变\n            let isJoinGroup = false;\n            if (type === 5) {\n                isJoinGroup = true;\n            }\n            let name = user.name;\n            let remark = user.remark;\n            let avatar = user.avatar;\n            // 判断是不是打开的这个对象\n            let selectedType = this.historyMsgListSelected.type || 0;\n            let id = this.historyMsgListSelected.id || 0;\n            let unMsgCount = 1;\n            let historyType = 2;\n            // 判断是不是聊天窗口的消息\n            if (selectedType === historyType && id === receiveId) {\n                let user = {\n                    uid: uid,\n                    name: name,\n                    avatar: avatar\n                };\n                this.pushChatMsgList(msgType, msgContent, user, createTime);\n                unMsgCount = 0;\n                // 如果超过 多少 个消息，则做一次 ACK 消息的操作\n                this.chatCount += 1;\n                if (this.chatCount >= this.chatMaxCount) {\n                    this.chatCount = 0;\n                    // 清空消息\n                    this.msgClearUnMsgCount(historyType, id);\n                }\n                // 入群消息\n                if (isJoinGroup) {\n                    let chatMsgGroupUserList = Object.assign(\n                        {},\n                        this.chatMsgGroupUserList\n                    );\n                    chatMsgGroupUserList[user.uid] = user;\n                    this.chatMsgGroupUserList = chatMsgGroupUserList;\n                }\n            }\n            let groupItem = this.userGroupList[receiveId];\n            name = groupItem.group ? groupItem.group.name : \"gd\" + receiveId;\n            remark = groupItem.group ? groupItem.group.remark : \"\";\n            avatar = groupItem.group ? groupItem.group.avatar : \"\";\n            this.pushHistoryMsg(\n                historyType,\n                receiveId,\n                name,\n                remark,\n                avatar,\n                msgContent,\n                unMsgCount,\n                createTime\n            );\n        },\n        // 发送ws消息\n        webSocketSend(payload) {\n            // 加入登录验证\n            payload.uid = parseInt(this.getUid());\n            payload.sid = this.getSid();\n            let buffer = this.WSResEncode(payload);\n            this.webSocket.send(buffer);\n        },\n        // 发送按钮点击\n        sendBtnClick() {\n            if (\n                !this.chatText ||\n                this.chatText === \"\" ||\n                /^[ ]+$/.test(this.chatText)\n            ) {\n                return false;\n            }\n            let item = this.historyMsgListSelected;\n            let msgType = 0; // 文本消息\n            if (item.type === 1) {\n                // 发送\n                let postData = {\n                    receiverUid: item.id,\n                    msgType: msgType,\n                    msgContent: this.chatText\n                };\n                userFriendMsgCreate(this.apiBaseUrl, postData)\n                    .then(response => {\n                        if (response.code !== 0) {\n                            this.requestErr(response.code, response.message);\n                            return false;\n                        }\n                        this.receiveMessage(\n                            item.type,\n                            item.id,\n                            item.name,\n                            item.remark,\n                            item.avatar,\n                            msgType,\n                            this.user,\n                            this.chatText,\n                            new Date()\n                        );\n                        this.chatText = \"\";\n                    })\n                    .catch(() => {});\n                return false;\n            }\n            if (item.type === 2) {\n                let postData = {\n                    groupId: item.id,\n                    msgType: msgType,\n                    msgContent: this.chatText\n                };\n                userGroupMsgCreate(this.apiBaseUrl, postData)\n                    .then(response => {\n                        if (response.code !== 0) {\n                            this.requestErr(response.code, response.message);\n                            return false;\n                        }\n                        this.receiveMessage(\n                            item.type,\n                            item.id,\n                            item.name,\n                            item.remark,\n                            item.avatar,\n                            msgType,\n                            this.user,\n                            this.chatText,\n                            new Date()\n                        );\n                        this.chatText = \"\";\n                    })\n                    .catch(() => {});\n                return false;\n            }\n        },\n        // 接收消息的追加\n        receiveMessage(\n            type,\n            id,\n            name,\n            remark,\n            avatar,\n            msgType,\n            user,\n            msgContent,\n            createTime\n        ) {\n            // 是否自动滚动到底部\n            this.chatMsgListScrollTop = true;\n            let data = {};\n            data.isMine = this.user.uid === user.uid;\n            if (this.historyMsgListSelected !== null) {\n                data.msgType = msgType;\n                data.user = user;\n                data.msgContent = this.createContent(msgContent);\n                data.createTime = this.formatDate(\n                    createTime,\n                    \"yyyy/MM/dd hh:mm:ss\"\n                );\n                this.chatMsgList.push(data);\n            }\n\n            let lastMsgContent = msgContent;\n            switch (msgType) {\n                case 1:\n                    lastMsgContent = \"[图片消息]\";\n                    break;\n                case 2:\n                    lastMsgContent = \"[文件消息]\";\n                    break;\n                case 3:\n                    lastMsgContent = \"[语言消息]\";\n                    break;\n                case 4:\n                    lastMsgContent = \"[视频消息]\";\n                    break;\n            }\n            let unMsgCount = data.isMine ? 0 : 1;\n            // 更新最后一次接收的消息\n            this.pushHistoryMsg(\n                type,\n                id,\n                name,\n                remark,\n                avatar,\n                lastMsgContent,\n                unMsgCount,\n                createTime\n            );\n        },\n        // 格式化文本消息, 这里主要做表情的筛选\n        createContent(text) {\n            if (typeof text === \"string\") {\n                text = this.htmlSpecialChars(text);\n                let html = text\n                    /* eslint-disable */\n                    .replace(/:emoji\\[([^\\s\\[\\]]+?)\\]/g, function(emoji) {\n                        // 转义表情\n                        var emojiId = \"emoji_\" + emoji.replace(/^:emoji/g, \"\");\n                        return document.getElementById(emojiId).innerHTML + \"&nbsp;\";\n                    })\n                    .replace(/\\n/g, \"<br>\");\n                return html;\n            }\n            return text;\n        },\n        getDate(dateStr) {\n            let date = new Date(dateStr);\n            if (isNaN(date.getDate())) {\n                // 说明有可能是手机端, 做一下处理\n                dateStr = dateStr.replace(/T/g, ' ');\n                dateStr = dateStr.replace(/-/g, '/');\n                dateStr = dateStr.replace(/\\.\\d+/, ' ');\n                date = new Date(dateStr);\n                // 如果还是转换不了\n                if (isNaN(date.getDate())) {\n                    return null;\n                }\n            }\n            return date;\n        },\n        // 日期的格式化\n        formatDate(dateStr, fmt) {\n            if (!dateStr) {\n                return \"\";\n            }\n            let date = this.getDate(dateStr);\n            if (!date) {\n                return \"\";\n            }\n            if (!fmt) {\n                fmt = \"yyyy-MM-dd\";\n            }\n            const o = {\n                \"M+\": date.getMonth() + 1, //月份\n                \"d+\": date.getDate(), //日\n                \"h+\": date.getHours(), //小时\n                \"m+\": date.getMinutes(), //分\n                \"s+\": date.getSeconds(), //秒\n                \"q+\": Math.floor((date.getMonth() + 3) / 3), //季度\n                S: date.getMilliseconds() //毫秒\n            };\n            if (/(y+)/.test(fmt))\n                fmt = fmt.replace(\n                    RegExp.$1,\n                    (date.getFullYear() + \"\").substr(4 - RegExp.$1.length)\n                );\n            for (let k in o)\n                if (new RegExp(\"(\" + k + \")\").test(fmt))\n                    fmt = fmt.replace(\n                        RegExp.$1,\n                        RegExp.$1.length === 1\n                            ? o[k]\n                            : (\"00\" + o[k]).substr((\"\" + o[k]).length)\n                    );\n            return fmt;\n        },\n        htmlSpecialChars(str) {\n            str = str.replace(/&/g, \"&amp;\");\n            str = str.replace(/</g, \"&lt;\");\n            str = str.replace(/>/g, \"&gt;\");\n            str = str.replace(/\"/g, \"&quot;\");\n            str = str.replace(/'/g, \"&#039;\");\n            return str;\n        },\n        // 弹出浏览器通知\n        notification(id, title, content, icon) {\n            var Notification =\n                window.Notification ||\n                window.mozNotification ||\n                window.webkitNotification;\n            // 判断浏览器是否支持桌面通知\n            if (Notification && Notification.permission === \"granted\") {\n                let notification = new Notification(title, {\n                    body: content,\n                    icon: icon\n                });\n                notification.onclick = (() => {\n                    // 点击了通知消息\n                    notification.close();\n                });\n            }\n        },\n        // 主面板的移动\n        moveImBox(e) {\n            // let ele = e.target;\n            //算出鼠标相对元素的位置\n            const _this = this;\n            // let disX = e.clientX - ele.offsetLeft;\n            // let disY = e.clientY - ele.offsetTop;\n            let disX = e.clientX - this.$refs.imBox.offsetLeft;\n            let disY = e.clientY - this.$refs.imBox.offsetTop;\n            _this.isMove = true;\n            document.onmousemove = (e)=>{\n                //鼠标按下并移动的事件\n                //用鼠标的位置减去鼠标相对元素的位置，得到元素的位置\n                let left = e.clientX - disX;\n                let top = e.clientY - disY;\n\n                //绑定元素位置到positionX和positionY上面\n                _this.imBoxPositionY = left + 'px';\n                _this.imBoxPositionX = top + 'px';\n\n            };\n            document.onmouseup = (e) => {\n                _this.isMove = false;\n                document.onmousemove = null;\n                document.onmouseup = null;\n            };\n        },\n        // 聊天界面的移动\n        moveChatMsg(e) {\n            // let ele = e.target;\n            //算出鼠标相对元素的位置\n            const _this = this;\n            // let disX = e.clientX - ele.offsetLeft;\n            // let disY = e.clientY - ele.offsetTop;\n            let disX = e.clientX - this.$refs.imChatBox.offsetLeft;\n            let disY = e.clientY - this.$refs.imChatBox.offsetTop;\n            let disW = this.$refs.imChatBox.clientWidth;\n            let disH = this.$refs.imChatBox.clientHeight;\n            _this.isMove = true;\n            document.onmousemove = (e)=>{\n                // 鼠标按下并移动的事件\n                // 用鼠标的位置减去鼠标相对元素的位置，得到元素的位置\n                let left = e.clientX - disX;\n                let top = e.clientY - disY;\n                // 判断是否到了临界值, 因为用了 transform: translate(-50%, -50%); 所以要除 2\n                if ((top > (disH / 2)) && ((_this.clientHeight - top) > (disH / 2))) {\n                    _this.chatMsgListPositionX = top + 'px';\n                }\n                if ((left > (disW / 2)) && ((_this.clientWidth - left) > (disW / 2))) {\n                    _this.chatMsgListPositionY = left + 'px';\n                }\n            };\n            document.onmouseup = (e) => {\n                _this.isMove = false;\n                document.onmousemove = null;\n                document.onmouseup = null;\n            };\n        }\n    },\n    directives: {\n        focus: {\n            update(el, { value }) {\n                if (value) {\n                    el.focus();\n                }\n            }\n        }\n    },\n    filters: {\n        getDefaultAvatar(avatar) {\n            if (avatar === null || avatar === \"\" || avatar === \"\") {\n                return \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWAgMAAABBb5lxAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURUxpcfDw8OPj4+Dg4FOJnTQAAAABdFJOUwBA5thmAAABUElEQVRYw+3Yy22EMBAGYDpLFUMOPlCCS3AVrmNLYJugBB9yy4UDKwHJhhj5Mdj/slYekn3+NPJ4PGNB87ICq2kQtV4x9l5ZZZVV9hvsjdpLnk30ufosG+6sy7HlrqjNsfGLkcqwYWMyw/TGXtNs21q8uYDN34zSbLKsT7LRMoUxmWQGY4NlXQmmLRM/yKwKi3qO6aLR/jJ7NFOB3RBR4iKZB5kq0Vlgny5Y1y8EjRpbBoHNty7DDDYGwaE6s4meneQrex5nn48tVZllI5fowdOmsGh90WiqVKbguWFVAEuP3TfwPQX7dJ9IbYrt3Ux0STBNBwPOY06woPwe0y4TR2wmbx0x4zPJs8VX3pk4bAyYG85hOmSCYxNFq2eYiZlkWKyc27mzhWEUs4ljfcRGjsmIDU+wrrJCzGBVYEuvInZjVFu/ASurrLL/y64N9sv6AwiKosleKgwtAAAAAElFTkSuQmCC\";\n            }\n            return avatar;\n        },\n        askAckStatusFilterName(index) {\n            const map = {\n                0: \"确认\",\n                1: \"已添加\",\n                2: \"已拒绝\"\n            };\n            return map[index];\n        }\n    },\n    mounted() {\n        // 获取浏览器可视区域高度\n        this.clientHeight = `${document.documentElement.clientHeight}`;\n        this.clientWidth = `${document.documentElement.clientWidth}`;\n\n        this.__resizeHandler = () => {\n            this.clientHeight = `${document.documentElement.clientHeight}`;\n            this.clientWidth = `${document.documentElement.clientWidth}`;\n        };\n\n        // 添加事件\n        window.addEventListener(\"resize\", this.__resizeHandler);\n    },\n    // 组件销毁\n    beforeDestroy() {\n        // 移除事件\n        window.removeEventListener(\"resize\", this.__resizeHandler);\n    },\n    created() {\n        // 判断是否自动初始化\n        if (this.isAutoInit) {\n            this.init();\n        }\n    },\n    computed: {\n        imBoxStyle () {\n            let data = {};\n            if (this.width) {\n                data.width = this.width;\n            }\n            if (this.height) {\n                data.height = this.height;\n            }\n            if (this.top) {\n                data.top = this.top;\n            }\n            if (this.left) {\n                data.left = this.left;\n            }\n            if (this.bottom) {\n                data.bottom = this.bottom;\n            }\n            if (this.right) {\n                data.right = this.right;\n            }\n            if (this.imBoxPositionX && this.isShow) {\n                data.top = this.imBoxPositionX;\n            }\n            if (this.imBoxPositionY && this.isShow) {\n                data.left = this.imBoxPositionY;\n            }\n            data = {\n                ...data,\n                ...this.themeSelected\n            };\n            return data;\n        },\n        imChatBoxStyle () {\n            let data = {};\n            data = {\n                top: this.chatMsgListPositionX,\n                left: this.chatMsgListPositionY,\n                ...this.themeSelected\n            };\n            return data;\n        },\n        sortHistoryMsgList: function () {\n            let historyMsgList = [];\n            let historyMsgListKeys = Object.keys(this.historyMsgList)\n                .sort((a, b) => {\n                    let aItem = this.historyMsgList[a];\n                    let bItem = this.historyMsgList[b];\n                    let aDate = this.getDate(aItem.modifiedTime);\n                    if (!aDate) {\n                        return -1;\n                    }\n                    let bDate = this.getDate(bItem.modifiedTime);\n                    if (!bDate) {\n                        return 1;\n                    }\n                    return bDate.getTime() - aDate.getTime();\n                })\n                .map((v) => {\n                    historyMsgList.push(this.historyMsgList[v]);\n                });\n            return historyMsgList;\n        }\n    },\n    watch: {\n        chatMsgList() {\n            const _this = this;\n            this.$nextTick(function(){\n                let chatMsgList = document.getElementById(\"chatMsgList\");\n                if (_this.chatMsgListScrollTop) {\n                    chatMsgList.scrollTop = chatMsgList.scrollHeight;\n                }\n            });\n        }\n    },\n    // 组件销毁时触发\n    destroyed() {\n        // 关闭 websocket 链接\n        this.wsOut();\n    }\n};\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src\\components\\Him","sourcesContent":["<template>\n    <div style=\"position: fixed; user-select:none;\">\n\n        <div class=\"im-move\" v-show=\"isMove\"></div>\n\n        <div class=\"im-box\" :class=\"isShow ? 'im-box-show' : ''\"\n             :style=\"imBoxStyle\"\n             ref=\"imBox\">\n            <div class=\"im-box-move\" @mousedown=\"moveImBox\"></div>\n\n            <div class=\"im-box-confirm-box\" v-if=\"confirm.isShow\" @click=\"confirm.isShow = false\">\n                <div class=\"im-box-confirm\">\n                    <div class=\"im-box-confirm-header\">\n                        <div class=\"im-box-confirm-title\">{{confirm.title}}</div>\n                    </div>\n                    <div class=\"im-box-confirm-content\">\n                        <div class=\"im-box-confirm-message\">{{confirm.message}}</div>\n                    </div>\n                    <div class=\"im-box-confirm-buttons\">\n                        <div class=\"im-box-confirm-button im-box-confirm-cancel\" @click=\"confirm.cancelHandle()\">{{confirm.cancelName}}</div>\n                        <div class=\"im-box-confirm-button im-box-confirm-ok\" @click=\"confirm.okHandle()\">{{confirm.okName}}</div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"user-qrcode-box\" v-if=\"userQRCodeVisible\" @click=\"userQRCodeCloseHandle\">\n                <div class=\"user-qrcode\">\n                    <img :src=\"userQRCodeImg\" alt=\"\" style=\"display: block;\" @click.stop=\"downloadImg(userQRCodeImg)\">\n                    <div class=\"user-qrcode-download\" @click.stop=\"downloadImg(userQRCodeImg)\">点击/长按保存二维码</div>\n                    <div class=\"user-uid\" @click.stop=\"\">用户ID: {{user.uid}}</div>\n                </div>\n            </div>\n\n            <div class=\"user-login-box\" v-if=\"!user.uid\" @click=\"isShowClick\">\n                <div class=\"user-login-list\">\n                    <a class=\"user-login-button\" href=\"javascript:\" @click=\"touristLogin(2)\">\n                        <img src=\"./image/user-2-default.png\" alt=\"女游客登录\">\n                        <span>女游客</span>\n                    </a>\n                    <a class=\"user-login-button\" href=\"javascript:\" @click=\"touristLogin(1)\">\n                        <img src=\"./image/user-1-default.png\" alt=\"男游客登录\">\n                        <span>男游客</span>\n                    </a>\n                    <a class=\"user-login-button\" href=\"javascript:\" @click=\"qqLoginClick\">\n                        <img src=\"./image/login-qq.png\" alt=\"QQ登录\">\n                        <span>QQ登录</span>\n                    </a>\n                </div>\n            </div>\n\n            <header class=\"im-panel-header\">\n                <div class=\"im-header-user\">\n                    <img class=\"im-header-user-avatar\" :src=\"user.avatar | getDefaultAvatar\" alt=\"头像\">\n                    <div class=\"im-header-user-content\">\n                        <div class=\"im-header-user-name\" :title=\"user.name\">\n                            {{ user.name }}\n                        </div>\n                        <div class=\"im-header-user-remark\" :title=\"user.remark\">\n                            {{ user.remark }}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"im-header-setwin\">\n                    <div class=\"im-header-out-login\" @click=\"userOutClick\" title=\"登出\">\n                        <img src=\"./image/out-login.png\" alt=\"登出\" style=\"width: 100%; height: 100%;\">\n                    </div>\n                    <div class=\"im-header-qrcode-box\" @click=\"userQRCodeClick\">\n                        <img src=\"./image/qrcode.png\" alt=\"二维码\" title=\"二维码\" style=\"width: 100%; height: 100%;\">\n                    </div>\n                    <i class=\"im-icon im-icon-ring-open\"></i>\n                    <i class=\"im-icon im-icon-panel-down\" @click=\"isShowClick\"></i>\n                </div>\n            </header>\n\n            <nav class=\"im-tab-nav\">\n                <ul class=\"im-tab\">\n                    <li v-for=\"item in imTabList\"\n                        :key=\"item.index\"\n                        class=\"im-tab-item\"\n                        :class=\"{'im-tab-item-selected': item.isSelected}\"\n                        @click=\"imTabSelectedHandle(item.index)\">\n                        {{ item.title }}\n                        <div class=\"im-tab-badge\"\n                             v-if=\"item.index === 1 && user.profile.friendAskCount > 0\">\n                            new\n                        </div>\n                    </li>\n                </ul>\n            </nav>\n\n            <!-- 历史消息-->\n            <main class=\"im-panel-body\" v-if=\"imTabSelectedIndex === 0\">\n                <div class=\"im-user-warning-box\" v-if=\"!webSocketIsOpen\">\n                    <div class=\"im-chat-warning\" style=\"top: 0;\" v-html=\"webSocketWarningText\"></div>\n                </div>\n                <div class=\"im-chat-reconnect\" v-if=\"!webSocketIsReconnect\">\n                    <a href=\"javascript:\" @click=\"init\">重新连接</a>\n                </div>\n                <div class=\"im-panel-searchbar\">\n                    <div class=\"im-panel-searchbar-inner\">\n                        <img src=\"./image/search.png\" class=\"im-panel-search\">\n                        <input type=\"search\" placeholder=\"搜索\" class=\"im-panel-searchbar-core\">\n                    </div>\n                </div>\n\n                <div class=\"im-list-empty\" v-if=\"Object.keys(historyMsgList).length === 0\">\n                    暂无数据\n                </div>\n\n                <ul class=\"im-panel-user-list\">\n\n                    <template v-for=\"(item) in sortHistoryMsgList\">\n                        <li @click=\"handleChat(item)\" :key=\"item.type + item.id\">\n                            <div class=\"im-user-left\">\n                                <img :src=\"item.avatar | getDefaultAvatar\" alt=\"\" class=\"im-user-avatar\">\n                            </div>\n                            <div class=\"im-user-right\">\n                                <div class=\"im-user-info\">\n                                <span class=\"im-user-name\" :title=\"item.name\">\n                                    {{ item.name }}\n                                </span>\n                                    <span class=\"im-user-remark\" :title=\"item.lastMsgContent\">\n                                    {{ item.lastMsgContent }}\n                                </span>\n                                </div>\n                            </div>\n                            <div class=\"im-panel-badge\" v-if=\"item.unMsgCount > 0\">{{ item.unMsgCount > 99 ? '99+' : item.unMsgCount }}</div>\n                        </li>\n                    </template>\n                </ul>\n\n            </main>\n\n            <!-- 朋友-->\n            <main class=\"im-panel-body\"  v-if=\"imTabSelectedIndex === 1\">\n\n                <div class=\"im-new-friend\" @click=\"newFriendClick\">\n                    <span>{{ newFriendVisible ? '返回' : '新的朋友'}}</span>\n                    <span style=\"color: red;\" v-if=\"!newFriendVisible && user.profile.friendAskCount > 0\">\n                        {{user.profile.friendAskCount}}\n                    </span>\n                </div>\n\n                <div class=\"im-list-empty\"\n                     v-if=\"(newFriendVisible && newFriendList.length === 0)\n                            || (!newFriendVisible && Object.keys(userFriendList).length === 0)\">\n                    暂无数据\n                </div>\n\n                <ul class=\"im-panel-user-list\" v-if=\"!newFriendVisible\">\n\n                    <template v-for=\"(item) in userFriendList\">\n                        <li @click=\"friendClick(item)\" :key=\"item.friendUid\">\n                            <div class=\"im-user-left\">\n                                <img :src=\"item.user.avatar | getDefaultAvatar\" alt=\"\" class=\"im-user-avatar\">\n                            </div>\n                            <div class=\"im-user-right\">\n                                <div class=\"im-user-info\">\n                                <span class=\"im-user-name\" :title=\"item.remark ? item.remark : item.user.name\">\n                                    {{ item.remark ? item.remark : item.user.name }}\n                                </span>\n                                    <span class=\"im-user-remark\" :title=\"item.user.remark\">\n                                    {{ item.user.remark }}\n                                </span>\n                                </div>\n                            </div>\n                        </li>\n                    </template>\n                </ul>\n\n                <div v-if=\"newFriendVisible\">\n                    <ul class=\"im-panel-user-list\">\n\n                        <template v-for=\"item in newFriendList\">\n                            <li :key=\"item.id\">\n                                <div class=\"im-user-left\">\n                                    <img :src=\"item.user && item.user.avatar | getDefaultAvatar\" alt=\"\" class=\"im-user-avatar\">\n                                </div>\n                                <div class=\"im-user-right\">\n                                    <div class=\"im-user-info\">\n                                <span class=\"im-user-name\" :title=\"item.user && item.user.name\">\n                                    {{ item.user && item.user.name }}\n                                </span>\n                                        <span class=\"im-user-remark\" :title=\"item.remark\">\n                                    {{ item.remark }}\n                                </span>\n                                    </div>\n                                </div>\n                                <div class=\"im-user-button\" :style=\"{color: item.status !== 0 ? '#ccc' : ''}\">\n                                    <span @click=\"askAck(item, 1)\">{{ item.status | askAckStatusFilterName }}</span>\n                                    <span v-if=\"item.status === 0\" @click=\"askAck(item, 2)\" style=\"margin-left: 3px;\">拒绝</span>\n                                </div>\n                            </li>\n                        </template>\n                    </ul>\n                    <div v-if=\"newFriendList.length !== 0\" class=\"im-new-friend-list-more\" @click=\"getUserFriendAskList\">\n                        {{ newFriendLoadMore ? '加载更多' : '没有更多了'}}\n                    </div>\n                </div>\n\n            </main>\n\n            <!-- 群组-->\n            <main class=\"im-panel-body\"  v-if=\"imTabSelectedIndex === 2\">\n\n                <div class=\"im-group-create\">\n                    <input type=\"text\" v-show=\"createGroupVisible\" v-model=\"createGroupName\" placeholder=\"输入群昵称\" style=\"\">\n                    <span class=\"im-group-create-button\" @click=\"createGroup\">{{ createGroupVisible ? '提交' : '新建'}}</span>\n                    <span class=\"im-group-create-button\"  v-show=\"createGroupVisible\" @click=\"createGroupClose\">取消</span>\n                </div>\n\n                <div class=\"im-list-empty\" v-if=\"Object.keys(userGroupList).length === 0\">\n                    暂无数据\n                </div>\n\n                <ul class=\"im-panel-user-list\">\n\n                    <template v-for=\"(item) in userGroupList\">\n                        <li @click=\"groupClick(item)\" :key=\"item.groupId\">\n                            <div class=\"im-user-left\">\n                                <img :src=\"item.group.avatar | getDefaultAvatar\" alt=\"\" class=\"im-user-avatar\">\n                            </div>\n                            <div class=\"im-user-right\">\n                                <div class=\"im-user-info\">\n                                <span class=\"im-user-name\" :title=\"item.group.name\">\n                                    {{ item.group.name }}\n                                </span>\n                                    <span class=\"im-user-remark\" :title=\"item.group.remark\">\n                                    {{ item.group.remark }}\n                                </span>\n                                </div>\n                            </div>\n                        </li>\n                    </template>\n                </ul>\n\n            </main>\n\n            <footer class=\"im-panel-footer\">\n                <div class=\"im-panel-theme\" @click=\"themeVisible = !themeVisible\">\n                    <img src=\"./image/theme.png\" alt=\"更换主题\">\n                </div>\n                <div class=\"im-panel-theme-list\" v-if=\"themeVisible\">\n                    <div class=\"im-panel-theme-item\" v-for=\"(item, index) in themeList\" :key=\"index\" @click=\"changeTheme(index, true)\">\n                        <div v-if=\"item['background-image']\" :style=\"item\"></div>\n                        <div v-else></div>\n                    </div>\n                </div>\n            </footer>\n\n        </div>\n\n        <!--聊天界面-->\n        <div class=\"im-chat-box\" v-show=\"chatVisible\" :style=\"imChatBoxStyle\" ref=\"imChatBox\">\n\n            <div class=\"group-qrcode-box\" v-if=\"groupQRCodeVisible\" @click=\"groupQRCodeCloseHandle\">\n                <div class=\"group-qrcode\">\n                    <img :src=\"groupQRCodeImg\" alt=\"\" style=\"display: block;\" @click.stop=\"downloadImg(groupQRCodeImg)\">\n                    <div class=\"group-qrcode-download\" @click.stop=\"downloadImg(groupQRCodeImg)\">点击/长按保存二维码</div>\n                    <div class=\"group-id\" @click.stop=\"\">群ID: {{historyMsgListSelected.id}}</div>\n                </div>\n            </div>\n\n            <div class=\"user-login-box\" v-if=\"!user.uid\">\n                <div class=\"user-login-list\">\n                    <a class=\"user-login-button\" href=\"javascript:\" @click=\"touristLogin(2)\">\n                        <img src=\"./image/user-2-default.png\" alt=\"女游客登录\">\n                        <span>女游客</span>\n                    </a>\n                    <a class=\"user-login-button\" href=\"javascript:\" @click=\"touristLogin(1)\">\n                        <img src=\"./image/user-1-default.png\" alt=\"男游客登录\">\n                        <span>男游客</span>\n                    </a>\n                    <a class=\"user-login-button\" href=\"javascript:\" @click=\"qqLoginClick\">\n                        <img src=\"./image/login-qq.png\" alt=\"QQ登录\">\n                        <span>QQ登录</span>\n                    </a>\n                </div>\n            </div>\n\n            <header class=\"im-chat-header\">\n                <div class=\"im-chat-move\" @mousedown=\"moveChatMsg\"></div>\n                <div class=\"im-chat-user\">\n                    <img :src=\"chatUser.avatar | getDefaultAvatar\" alt=\"\" class=\"im-chat-user-avatar\">\n                    <div class=\"im-chat-user-info\">\n                        <span class=\"im-chat-user-name\" :title=\"chatUser.name\">\n                            {{ chatUser.name }}\n                        </span>\n                        <span class=\"im-chat-user-list-button\" v-if=\"Object.keys(chatMsgGroupUserList).length > 0\">\n                            {{Object.keys(chatMsgGroupUserList).length}}人\n                        </span>\n                        <i class=\"im-icon im-icon-panel-down\" v-if=\"chatUser.type === 2\" @click=\"isShowGroupUserListClick\"></i>\n                        <span class=\"im-chat-user-remark\" :title=\"chatUser.remark\">\n                            {{ chatUser.remark }}\n                        </span>\n                    </div>\n                </div>\n                <div class=\"im-chat-setwin\">\n                    <div class=\"im-icon-close\" style=\"cursor: pointer;\" @click=\"groupQRCodeClick\" v-if=\"historyMsgListSelected.type === 2\">\n                        <img src=\"./image/qrcode.png\" alt=\"二维码\" title=\"二维码\" style=\"width: 100%; height: 100%;vertical-align: text-bottom;\">\n                    </div>\n                    <i class=\"im-icon im-icon-close\" @click=\"closeChat\"></i>\n                </div>\n                <div class=\"im-chat-warning\" v-if=\"!webSocketIsOpen\" v-html=\"webSocketWarningText\"></div>\n            </header>\n\n            <nav style=\"display: none;\">\n                <div id=\"emoji_[smile]\"><img src=\"./emoji/smile.png\" class=\"im-chat-msg-emoji\" title=\"smile\" alt=\"smile\"></div>\n                <div id=\"emoji_[laughing]\"><img src=\"./emoji/laughing.png\" class=\"im-chat-msg-emoji\" title=\"laughing\" alt=\"laughing\"></div>\n                <div id=\"emoji_[blush]\"><img src=\"./emoji/blush.png\" class=\"im-chat-msg-emoji\" title=\"blush\" alt=\"blush\"></div>\n                <div id=\"emoji_[heart_eyes]\"><img src=\"./emoji/heart_eyes.png\" class=\"im-chat-msg-emoji\" title=\"heart_eyes\" alt=\"heart_eyes\"></div>\n                <div id=\"emoji_[smirk]\"><img src=\"./emoji/smirk.png\" class=\"im-chat-msg-emoji\" title=\"smirk\" alt=\"smirk\"></div>\n                <div id=\"emoji_[flushed]\"><img src=\"./emoji/flushed.png\" class=\"im-chat-msg-emoji\" title=\"flushed\" alt=\"flushed\"></div>\n                <div id=\"emoji_[grin]\"><img src=\"./emoji/grin.png\" class=\"im-chat-msg-emoji\" title=\"grin\" alt=\"grin\"></div>\n                <div id=\"emoji_[kissing_smiling_eyes]\"><img src=\"./emoji/kissing_smiling_eyes.png\" class=\"im-chat-msg-emoji\" title=\"kissing_smiling_eyes\" alt=\"kissing_smiling_eyes\"></div>\n                <div id=\"emoji_[wink]\"><img src=\"./emoji/wink.png\" class=\"im-chat-msg-emoji\" title=\"wink\" alt=\"wink\"></div>\n                <div id=\"emoji_[kissing_closed_eyes]\"><img src=\"./emoji/kissing_closed_eyes.png\" class=\"im-chat-msg-emoji\" title=\"kissing_closed_eyes\" alt=\"kissing_closed_eyes\"></div>\n                <div id=\"emoji_[stuck_out_tongue_winking_eye]\"><img src=\"./emoji/stuck_out_tongue_winking_eye.png\" class=\"im-chat-msg-emoji\" title=\"stuck_out_tongue_winking_eye\" alt=\"stuck_out_tongue_winking_eye\"></div>\n                <div id=\"emoji_[sleeping]\"><img src=\"./emoji/sleeping.png\" class=\"im-chat-msg-emoji\" title=\"sleeping\" alt=\"sleeping\"></div>\n                <div id=\"emoji_[worried]\"><img src=\"./emoji/worried.png\" class=\"im-chat-msg-emoji\" title=\"worried\" alt=\"worried\"></div>\n                <div id=\"emoji_[sweat_smile]\"><img src=\"./emoji/sweat_smile.png\" class=\"im-chat-msg-emoji\" title=\"sweat_smile\" alt=\"sweat_smile\"></div>\n                <div id=\"emoji_[cold_sweat]\"><img src=\"./emoji/cold_sweat.png\" class=\"im-chat-msg-emoji\" title=\"cold_sweat\" alt=\"cold_sweat\"></div>\n                <div id=\"emoji_[joy]\"><img src=\"./emoji/joy.png\" class=\"im-chat-msg-emoji\" title=\"joy\" alt=\"joy\"></div>\n                <div id=\"emoji_[sob]\"><img src=\"./emoji/sob.png\" class=\"im-chat-msg-emoji\" title=\"sob\" alt=\"sob\"></div>\n                <div id=\"emoji_[angry]\"><img src=\"./emoji/angry.png\" class=\"im-chat-msg-emoji\" title=\"angry\" alt=\"angry\"></div>\n                <div id=\"emoji_[mask]\"><img src=\"./emoji/mask.png\" class=\"im-chat-msg-emoji\" title=\"mask\" alt=\"mask\"></div>\n                <div id=\"emoji_[scream]\"><img src=\"./emoji/scream.png\" class=\"im-chat-msg-emoji\" title=\"scream\" alt=\"scream\"></div>\n                <div id=\"emoji_[sunglasses]\"><img src=\"./emoji/sunglasses.png\" class=\"im-chat-msg-emoji\" title=\"sunglasses\" alt=\"sunglasses\"></div>\n                <div id=\"emoji_[thumbsup]\"><img src=\"./emoji/thumbsup.png\" class=\"im-chat-msg-emoji\" title=\"thumbsup\" alt=\"thumbsup\"></div>\n                <div id=\"emoji_[clap]\"><img src=\"./emoji/clap.png\" class=\"im-chat-msg-emoji\" title=\"clap\" alt=\"clap\"></div>\n                <div id=\"emoji_[ok_hand]\"><img src=\"./emoji/ok_hand.png\" class=\"im-chat-msg-emoji\" title=\"ok_hand\" alt=\"ok_hand\"></div>\n            </nav>\n\n            <div class=\"im-chat-user-list\" v-if=\"chatMsgGroupUserVisible\">\n                <div class=\"im-chat-user-list-item\" v-for=\"item in chatMsgGroupUserList\" :key=\"item.user.uid\">\n                    <img :src=\"item.user.avatar | getDefaultAvatar\">\n                    <cite>{{item.user.name}}</cite>\n                </div>\n            </div>\n\n            <main class=\"im-chat-main\" id=\"chatMsgList\">\n                <a class=\"im-list-more\" @click=\"getChatMsgList\">{{ chatMsgListHandleMoreText }}</a>\n                <template v-for=\"(item, index) in chatMsgList\">\n                    <div class=\"im-chat-msg-box\" :class=\"item.isMine ? 'im-chat-msg-mine' : ''\" :key=\"index\">\n                        <div class=\"im-chat-msg-user\">\n                            <img :src=\"item.user.avatar | getDefaultAvatar\">\n                            <div class=\"im-chat-msg-user-remark\" v-if=\"item.isMine\">\n                                <i>{{ item.createTime }}</i><span>{{ item.user.name }}</span>\n                            </div>\n                            <div class=\"im-chat-msg-user-remark\" v-else>\n                                <span>{{ item.user.name }}</span><i>{{ item.createTime }}</i>\n                            </div>\n                        </div>\n                        <div class=\"im-chat-msg-text\" v-html=\"item.msgContent\"></div>\n                    </div>\n                </template>\n\n            </main>\n\n            <footer class=\"im-chat-footer\">\n                <div class=\"im-chat-feature-holder\">\n                    <div class=\"im-chat-feature-btn-box\">\n                        <div class=\"im-chat-feature-btn im-icon im-icon-emoji im-emoji-box\" @click=\"handleEmoji\">\n                            <div class=\"im-emoji-holder\" v-if=\"emojiVisible\">\n                                <template v-for=\"(item, index) in emojiList\">\n                                    <i class=\"im-emoji-control\" :key=\"item.code\" @click=\"selectEmoji(item)\" :title=\"item.title\" :style=\"{backgroundPosition: '0 ' + index * -25 + 'px'}\"></i>\n                                </template>\n                            </div>\n                        </div>\n                        <div class=\"im-chat-feature-btn im-icon im-icon-photo\"></div>\n                        <div class=\"im-chat-feature-btn im-icon im-icon-upload\"></div>\n                    </div>\n                </div>\n                <div class=\"im-chat-text-holder\">\n                    <textarea placeholder=\"请输入\" ref=\"himChatText\" @blur=\"chatTextBlur\" v-model=\"chatText\"></textarea>\n                </div>\n                <div class=\"im-chat-send-box\">\n                    <div class=\"im-chat-send\">\n                        <div class=\"im-chat-send-btn\" @click=\"closeChat\">关闭</div>\n                        <div class=\"im-chat-send-btn\" @click=\"sendBtnClick\">发送</div>\n                    </div>\n                </div>\n            </footer>\n        </div>\n\n    </div>\n</template>\n\n<script>\n// @ is an alias to /src\nimport Cookies from \"js-cookie\";\nimport { userLoginInfo, userQRCheckCode } from \"./api/userIndex\";\nimport { userFriendLists } from \"./api/userFriend\";\nimport { userLoginByTourist, userLoginByQq } from \"./api/userLogin\";\nimport {\n    userFriendMsgClearUnMsgCount,\n    userFriendMsgCreate,\n    userFriendMsgLists\n} from \"./api/userFriendMsg\";\nimport {\n    userFriendAskAck,\n    userFriendAskClearFriendAskCount,\n    userFriendAskCreate,\n    userFriendAskLists\n} from \"./api/userFriendAsk\";\nimport { userGroupCreate, userGroupLists } from \"./api/userGroup\";\nimport {\n    userGroupUserCheckCode,\n    userGroupUserClearUnMsgCount,\n    userGroupUserCreate,\n    userGroupUserDelete,\n    userGroupUserLists,\n    userGroupUserUpdate\n} from \"./api/userGroupUser\";\nimport { userGroupMsgCreate, userGroupMsgLists } from \"./api/userGroupMsg\";\n\nlet QRCode = require(\"qrcode\");\nexport default {\n    name: \"Him\",\n    props: {\n        isShow: {\n            type: Boolean,\n            default: true\n        },\n        width: {\n            type: String,\n            default: \"100%\"\n        },\n        height: {\n            type: String,\n            default: \"100%\"\n        },\n        top: String,\n        left: String,\n        bottom: String,\n        right: String,\n        apiBaseUrl: String,\n        webSocketUrl: String,\n        userQRCodeUrl: String, // 用户二维码的生成地址\n        groupQRCodeUrl: String, // 群二维码的生成地址\n        // 是否自动初始化\n        isAutoInit: {\n            type: Boolean,\n            default: true\n        },\n        // 尝试重新连接的最大次数\n        webSocketReconnectMaxCount: {\n            type: Number,\n            default: 5\n        },\n        // WebSocket 编码\n        WSResEncode: {\n            type: Function,\n            default: function(data) {\n                return JSON.stringify(data);\n            }\n        },\n        // WebSocket 编码\n        WSResDecode: {\n            type: Function,\n            default: function(data) {\n                return JSON.parse(data);\n            }\n        }\n    },\n    data() {\n        return {\n            themeList: [\n                {\n                    \"background-image\":\n                        \"url(\" + require(\"./image/bg-1.jpg\") + \")\",\n                    \"background-repeat\": \"no-repeat\",\n                    \"background-size\": \"cover\",\n                    \"background-color\": \"#f6f6f6\"\n                },\n                {\n                    \"background-image\":\n                        \"url(\" + require(\"./image/bg-2.jpg\") + \")\",\n                    \"background-repeat\": \"no-repeat\",\n                    \"background-size\": \"cover\",\n                    \"background-color\": \"#f6f6f6\"\n                },\n                {\n                    \"background-image\":\n                        \"url(\" + require(\"./image/bg-3.jpg\") + \")\",\n                    \"background-repeat\": \"no-repeat\",\n                    \"background-size\": \"cover\",\n                    \"background-color\": \"#f6f6f6\"\n                },\n                {\n                    \"background-image\":\n                        \"url(\" + require(\"./image/bg-4.jpg\") + \")\",\n                    \"background-repeat\": \"no-repeat\",\n                    \"background-size\": \"cover\",\n                    \"background-color\": \"#f6f6f6\"\n                },\n                {\n                    \"background-image\":\n                        \"url(\" + require(\"./image/bg-5.jpg\") + \")\",\n                    \"background-repeat\": \"no-repeat\",\n                    \"background-size\": \"cover\",\n                    \"background-color\": \"#f6f6f6\"\n                },\n                {\n                    \"background-repeat\": \"no-repeat\",\n                    \"background-size\": \"cover\",\n                    \"background-color\": \"#f6f6f6\"\n                }\n            ],\n            themeSelected: {\n                \"background-repeat\": \"no-repeat\",\n                \"background-size\": \"cover\",\n                \"background-color\": \"#f6f6f6\"\n            },\n            themeVisible: false,\n            imTabList: [\n                {\n                    index: 0,\n                    isSelected: true,\n                    title: \"消息\"\n                },\n                {\n                    index: 1,\n                    isSelected: false,\n                    title: \"朋友\"\n                },\n                {\n                    index: 2,\n                    isSelected: false,\n                    title: \"群组\"\n                }\n            ],\n            imTabSelectedIndex: 0, // 选中的index\n            userQRCodeImg: null,\n            userQRCodeVisible: false,\n            groupQRCodeImg: null,\n            groupQRCodeVisible: false,\n            isMove: false,\n            clientWidth: null,\n            clientHeight: null,\n            user: {\n                profile: {},\n                sid: null\n            },\n            imBoxPositionX: null,\n            imBoxPositionY: null,\n            userFriendList: {},\n            userFriendListLimit: 500, // 每次拉取多少好友\n            newFriendVisible: false,\n            newFriendQuery: {\n                page: 1,\n                limit: 20\n            },\n            newFriendList: [],\n            newFriendLoading: false,\n            newFriendLoadMore: true, // 是否还可以加载更多\n            userGroupList: {}, // 群列表\n            userGroupListLimit: 500, // 群列表每次拉取\n            historyMsgList: {},\n            historyMsgListSelected: {}, // 历史消息的选中值\n            createGroupName: \"\",\n            createGroupVisible: false,\n            chatVisible: false,\n            emojiList: [\n                {\n                    title: \"微笑\",\n                    code: \"smile\"\n                },\n                {\n                    title: \"发笑\",\n                    code: \"laughing\"\n                },\n                {\n                    title: \"害羞\",\n                    code: \"blush\"\n                },\n                {\n                    title: \"心眼\",\n                    code: \"heart_eyes\"\n                },\n                {\n                    title: \"傻笑\",\n                    code: \"smirk\"\n                },\n                {\n                    title: \"激动\",\n                    code: \"flushed\"\n                },\n                {\n                    title: \"咧嘴\",\n                    code: \"grin\"\n                },\n                {\n                    title: \"亲亲\",\n                    code: \"kissing_smiling_eyes\"\n                },\n                {\n                    title: \"眨眼\",\n                    code: \"wink\"\n                },\n                {\n                    title: \"害羞的亲亲\",\n                    code: \"kissing_closed_eyes\"\n                },\n                {\n                    title: \"调皮\",\n                    code: \"stuck_out_tongue_winking_eye\"\n                },\n                {\n                    title: \"晚安\",\n                    code: \"sleeping\"\n                },\n                {\n                    title: \"担心\",\n                    code: \"worried\"\n                },\n                {\n                    title: \"激动的微信\",\n                    code: \"sweat_smile\"\n                },\n                {\n                    title: \"冷汗\",\n                    code: \"cold_sweat\"\n                },\n                {\n                    title: \"笑哭\",\n                    code: \"joy\"\n                },\n                {\n                    title: \"哭泣\",\n                    code: \"sob\"\n                },\n                {\n                    title: \"愤怒\",\n                    code: \"angry\"\n                },\n                {\n                    title: \"生病\",\n                    code: \"mask\"\n                },\n                {\n                    title: \"尖叫\",\n                    code: \"scream\"\n                },\n                {\n                    title: \"墨镜\",\n                    code: \"sunglasses\"\n                },\n                {\n                    title: \"缩略图\",\n                    code: \"thumbsup\"\n                },\n                {\n                    title: \"鼓掌\",\n                    code: \"clap\"\n                },\n                {\n                    title: \"OK\",\n                    code: \"ok_hand\"\n                }\n            ],\n            emojiVisible: false,\n            chatUser: {},\n            chatTextFocus: false,\n            chatCount: 0, // 当前窗口收到的消息总量\n            chatText: \"\",\n            chatMsgListPositionX: null,\n            chatMsgListPositionY: null,\n            chatMsgList: [],\n            chatMsgListFriendQuery: {\n                senderUid: null,\n                page: 1,\n                limit: 25\n            },\n            chatMsgListGroupQuery: {\n                groupId: null,\n                page: 1,\n                limit: 25\n            },\n            chatMsgGroupUserList: {},\n            chatMsgGroupUserVisible: false,\n            chatMsgListScrollTop: true,\n            chatMsgListHandleLoading: false,\n            chatMsgListHandleMoreText: \"\",\n            chatMaxCount: 1, // 最大消息数, 用作有多少条消息就 ack 一次, 后期可以做成定时器\n            webSocket: null,\n            webSocketReconnectCount: 0,\n            webSocketIsReconnect: true, // 是否重连\n            webSocketWarningText:\n                \"连接断开,正在尝试重连 <i class='dotting'></i>\",\n            webSocketIsOpen: false,\n            // 心跳定时器\n            webSocketPingTimer: null,\n            webSocketPingTime: 10000, // 心跳的间隔，当前为 10秒,\n            confirm: {\n                isShow: false, // 是否显示\n                title: \"提示\", // 标题\n                message: \"确定执行吗?\", // 标题\n                okHandle: function() {}, // 确认的回调\n                okName: \"确认\", // 确认按钮的名称\n                cancelHandle: function() {}, // 取消的回调\n                cancelName: \"取消\" // 取消按钮的名称\n            }\n        };\n    },\n    methods: {\n        // 输入框的失去焦点事件, 解决微信中的bug\n        chatTextBlur() {\n            window.scroll(0, 0);\n        },\n        // 判断字符是否为空的方法\n        isEmpty(obj) {\n            return (\n                !obj || typeof obj === \"undefined\" || obj === null || obj === \"\"\n            );\n        },\n        // 设置 登录用户ID\n        setUid(value) {\n            Cookies.set(\"UID\", value, {\n                expires: 365,\n                path: \"/\"\n            });\n        },\n        getUid() {\n            let uid = Cookies.get(\"UID\", {\n                path: \"/\"\n            });\n            if (this.isEmpty(uid)) {\n                return null;\n            }\n            return uid;\n        },\n        delUid() {\n            Cookies.remove(\"UID\", {\n                path: \"/\"\n            });\n        },\n        setSid(value) {\n            Cookies.set(\"SID\", value, {\n                expires: 365,\n                path: \"/\"\n            });\n        },\n        getSid() {\n            let sid = Cookies.get(\"SID\", {\n                path: \"/\"\n            });\n            if (this.isEmpty(sid)) {\n                return null;\n            }\n            return sid;\n        },\n        delSid() {\n            Cookies.remove(\"SID\", {\n                path: \"/\"\n            });\n        },\n        setLocalStorage(name, value) {\n            localStorage.setItem(name, value);\n        },\n        getLocalStorage(name) {\n            return localStorage.getItem(name);\n        },\n        // 点击切换主题\n        changeTheme(index, isLocalStorage) {\n            // 判断是否存在下标\n            if (\n                index === null ||\n                index < 0 ||\n                this.themeList.length === 0 ||\n                index >= this.themeList.length\n            ) {\n                return false;\n            }\n            let themeSelected = this.themeList[index];\n            if (themeSelected) {\n                this.themeSelected = themeSelected;\n                if (isLocalStorage === true) {\n                    this.setLocalStorage(\"themSelectedIndex\", index);\n                }\n            }\n        },\n        // 点击了 QQ 登录\n        qqLoginClick() {\n            // 传递到父组件\n            this.$emit(\"on-qq-login-click\");\n        },\n        // im-box 的询问框\n        confirmInit(\n            title,\n            message,\n            okHandle,\n            cancelHandle,\n            okName,\n            cancelName\n        ) {\n            this.confirm.isShow = true;\n            this.confirm.title = title;\n            this.confirm.message = message;\n            this.confirm.okHandle = okHandle;\n            this.confirm.cancelHandle = cancelHandle;\n            if (okName) {\n                this.confirm.okName = okName;\n            }\n            if (cancelName) {\n                this.confirm.cancelName = cancelName;\n            }\n        },\n        userOutClick() {\n            this.confirmInit(\n                \"提示\",\n                \"确定登出吗?\",\n                () => {\n                    // 确定了\n                    this.userOut();\n                },\n                () => {\n                    // 取消了登出\n                    this.confirm.isShow = false;\n                }\n            );\n        },\n        // 登出\n        userOut() {\n            this.delUid();\n            this.delSid();\n            this.user = {\n                profile: {},\n                sid: null\n            };\n            this.userFriendList = {};\n            this.newFriendList = [];\n            this.userGroupList = {};\n            this.historyMsgList = {};\n            this.historyMsgListSelected = {};\n            this.chatMsgList = [];\n            this.chatMsgGroupUserList = {};\n            this.chatCount = 0;\n            this.userQRCodeImg = null;\n            // 关闭websocket 连接\n            this.wsOut();\n        },\n        // 游客登录\n        touristLogin(sex) {\n            // 先退出\n            this.userOut();\n            userLoginByTourist(this.apiBaseUrl, sex)\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    let data = response.data;\n                    // 设置登录信息\n                    this.setUid(data.uid);\n                    this.setSid(data.sid);\n                    // 登录成功, 重新初始化\n                    this.init();\n                })\n                .catch(() => {});\n        },\n        // QQ 登录\n        qqLogin(code, redirectUri) {\n            this.userOut();\n            userLoginByQq(this.apiBaseUrl, code, redirectUri)\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    let data = response.data;\n                    // 设置登录信息\n                    this.setUid(data.uid);\n                    this.setSid(data.sid);\n                    // 登录成功, 重新初始化\n                    this.init();\n                })\n                .catch(() => {});\n        },\n        // 初始化界面\n        init() {\n            // 初始化主题背景\n            let themSelectedIndex = this.getLocalStorage(\"themSelectedIndex\");\n            this.changeTheme(themSelectedIndex, false);\n            // 初始化用户信息\n            this.userInit();\n            // 打开通知, try 一下, 因为一些浏览器不兼容, 会报错\n            try {\n                var Notification =\n                    window.Notification ||\n                    window.mozNotification ||\n                    window.webkitNotification;\n                // 判断浏览器是否支持桌面通知\n                if (Notification) {\n                    let requestPermission = Notification.requestPermission();\n                    if (requestPermission.then) {\n                        requestPermission.then(function(result) {\n                            // result可能是是granted, denied, 或default.\n                            if (result) {\n                                // console.log(result);\n                            }\n                        });\n                    }\n                }\n            } catch (e) {\n                // console.log(e);\n            }\n        },\n        // 请求错误处理\n        requestErr(code, message) {\n            // 登录失效的\n            if (code === 1) {\n                this.delUid();\n                this.delSid();\n            }\n            // 向父组件传递出去\n            this.$emit(\"on-request-err\", code, message);\n        },\n        userQRCodeClick() {\n            if (this.userQRCodeImg) {\n                this.userQRCodeVisible = true;\n                return false;\n            }\n            userQRCheckCode(this.apiBaseUrl)\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    var opts = {\n                        errorCorrectionLevel: \"H\",\n                        type: \"image/jpeg\",\n                        rendererOpts: {\n                            quality: 0.3\n                        }\n                    };\n                    let qrCodeUrl = this.userQRCodeUrl + response.data;\n                    console.log(qrCodeUrl);\n                    // 生成二维码\n                    QRCode.toDataURL(qrCodeUrl, opts, (error, url) => {\n                        if (error) {\n                            alert(error);\n                            return false;\n                        }\n                        this.userQRCodeVisible = true;\n                        this.userQRCodeImg = url;\n                    });\n                })\n                .catch(() => {});\n        },\n        // 关闭用户二维码\n        userQRCodeCloseHandle() {\n            this.userQRCodeVisible = false;\n        },\n        // 群二维码\n        groupQRCodeClick() {\n            if (this.groupQRCodeImg) {\n                this.groupQRCodeVisible = true;\n                return false;\n            }\n            userGroupUserCheckCode(\n                this.apiBaseUrl,\n                this.historyMsgListSelected.id\n            )\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    var opts = {\n                        errorCorrectionLevel: \"H\",\n                        type: \"image/jpeg\",\n                        rendererOpts: {\n                            quality: 0.3\n                        }\n                    };\n                    let qrCodeUrl = this.groupQRCodeUrl + response.data;\n                    console.log(qrCodeUrl);\n                    // 生成二维码\n                    QRCode.toDataURL(qrCodeUrl, opts, (error, url) => {\n                        if (error) {\n                            alert(error);\n                            return false;\n                        }\n                        this.groupQRCodeVisible = true;\n                        this.groupQRCodeImg = url;\n                    });\n                })\n                .catch(() => {});\n        },\n        // 关闭用户二维码\n        groupQRCodeCloseHandle() {\n            this.groupQRCodeVisible = false;\n        },\n        // 点击下载图片\n        downloadImg(url) {\n            // 生成一个a元素\n            var a = document.createElement(\"a\");\n            // 创建一个单击事件\n            var event = new MouseEvent(\"click\");\n            // 将a的download属性设置为我们想要下载的图片名称，若name不存在则使用‘下载图片名称’作为默认名称\n            a.download = this.user.name;\n            // 将生成的URL设置为a.href属性\n            a.href = url;\n            // 触发a的单击事件\n            a.dispatchEvent(event);\n        },\n        // 去换Tab\n        imTabSelectedHandle(index) {\n            let data = [];\n            for (let item of this.imTabList) {\n                let isSelected = false;\n                if (item.index === index) {\n                    this.imTabSelectedIndex = index;\n                    isSelected = true;\n                }\n                item.isSelected = isSelected;\n                data.push(item);\n            }\n            this.imTabList = data;\n        },\n        msgClearUnMsgCount(type, id) {\n            if (type === 1) {\n                // 清空未读消息数量\n                let query = {\n                    receiverUid: id\n                };\n                userFriendMsgClearUnMsgCount(this.apiBaseUrl, query);\n            } else if (type === 2) {\n                userGroupUserClearUnMsgCount(this.apiBaseUrl, id);\n            }\n        },\n        // 打开聊天界面\n        handleChat(item) {\n            if (item.unMsgCount > 0) {\n                this.msgClearUnMsgCount(item.type, item.id);\n                let key = item.type + \"-\" + item.id;\n                this.historyMsgList[key].unMsgCount = 0;\n            }\n            this.chatVisible = true;\n            this.chatUser = item;\n            this.chatMsgList = [];\n            this.historyMsgListSelected = item;\n            this.chatMsgListFriendQuery.page = 1;\n            this.chatMsgListGroupQuery.page = 1;\n            this.chatMsgGroupUserList = {};\n            // 追加\n            this.getChatMsgList();\n        },\n        // 追加历史消息列表\n        getChatMsgList() {\n            if (this.chatMsgListHandleLoading) {\n                return false;\n            }\n            // 不是第一次加载时\n            if (this.chatMsgList.length !== 0) {\n                this.chatMsgListScrollTop = false;\n            }\n            this.chatMsgListHandleLoading = true;\n            this.chatMsgListHandleMoreText = \"加载中\";\n            let historyItem = this.historyMsgListSelected;\n            let isLoad = true; // 是否是加载更多\n            // 如果是好友类型\n            if (historyItem.type === 1) {\n                let senderUid = historyItem.id;\n                this.chatMsgListFriendQuery.senderUid = historyItem.id;\n                userFriendMsgLists(this.apiBaseUrl, this.chatMsgListFriendQuery)\n                    .then(response => {\n                        this.chatMsgListFriendQuery.page += 1;\n                        this.chatMsgListHandleLoading = false;\n                        if (response.code !== 0) {\n                            this.requestErr(response.code, response.message);\n                            return false;\n                        }\n                        let list = response.data;\n                        if (list.length === 0) {\n                            this.chatMsgListHandleMoreText = \"没有更多了\";\n                            return false;\n                        }\n                        for (let item of list) {\n                            let isMine = this.user.uid === item.senderUid;\n                            let user = {};\n                            if (isMine) {\n                                user = {\n                                    uid: this.user.uid,\n                                    name: this.user.name,\n                                    avatar: this.user.avatar\n                                };\n                            } else {\n                                user = {\n                                    uid: senderUid,\n                                    name: historyItem.name,\n                                    avatar: historyItem.avatar\n                                };\n                            }\n                            // 追加到消息列表\n                            this.pushChatMsgList(\n                                item.msgType,\n                                item.msgContent,\n                                user,\n                                item.createTime,\n                                isLoad\n                            );\n                        }\n                        this.chatMsgListHandleMoreText = \"加载更多消息\";\n                    })\n                    .catch(() => {\n                        this.chatMsgListHandleLoading = false;\n                        this.chatMsgListHandleMoreText = \"\";\n                    });\n            } else if (historyItem.type === 2) {\n                this.chatMsgListGroupQuery.groupId = historyItem.id;\n                userGroupMsgLists(this.apiBaseUrl, this.chatMsgListGroupQuery)\n                    .then(response => {\n                        this.chatMsgListGroupQuery.page += 1;\n                        this.chatMsgListHandleLoading = false;\n                        if (response.code !== 0) {\n                            this.requestErr(response.code, response.message);\n                            return false;\n                        }\n                        let list = response.data;\n                        if (list.length === 0) {\n                            this.chatMsgListHandleMoreText = \"没有更多了\";\n                            return false;\n                        }\n                        for (let item of list) {\n                            // 追加到消息列表\n                            this.pushChatMsgList(\n                                item.msgType,\n                                item.msgContent,\n                                item.user,\n                                item.createTime,\n                                isLoad\n                            );\n                        }\n                        this.chatMsgListHandleMoreText = \"加载更多消息\";\n                    })\n                    .catch(() => {\n                        this.chatMsgListHandleLoading = false;\n                        this.chatMsgListHandleMoreText = \"\";\n                    });\n            }\n        },\n        isShowClick() {\n            // 传递到父组件\n            this.$emit(\"on-is-show-click\");\n        },\n        // 关闭\n        closeChat() {\n            let selectedType = this.historyMsgListSelected.type || 0;\n            let id = this.historyMsgListSelected.id || 0;\n            this.historyMsgListSelected = {};\n            this.chatMsgList = [];\n            this.chatVisible = false;\n            // 清空文本\n            this.chatText = \"\";\n            // 清空群聊的二维码信息\n            this.groupQRCodeImg = null;\n            // 如果有当前窗口有未读消息，清除一下未读消息\n            if (this.chatCount > 0) {\n                this.chatCount = 0;\n                // 清空消息\n                this.msgClearUnMsgCount(selectedType, id);\n            }\n        },\n        // emoji 表情\n        handleEmoji() {\n            this.emojiVisible = !this.emojiVisible;\n        },\n        selectEmoji(item) {\n            this.chatText += \":emoji[\" + item.code + \"]\";\n            this.chatTextFocus = true;\n        },\n        userInit() {\n            if (!this.getUid() || !this.getSid()) {\n                return false;\n            }\n            userLoginInfo(this.apiBaseUrl, {})\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    let data = response.data;\n                    this.user = data;\n                    // 向父组件传递登录初始化完成\n                    this.$emit(\"on-login-init\");\n                    // 递归拉取好友\n                    this.getUserFriendList(1, this.userFriendListLimit);\n                    // 递归拉取群列表\n                    this.getUserGroupList(1, this.userGroupListLimit);\n\n                    // 初始化 WebSocket\n                    this.webSocketInit();\n                })\n                .catch(() => {});\n        },\n        // 获取用户朋友列表\n        getUserFriendList(page, limit) {\n            let query = {\n                page: page,\n                limit: limit\n            };\n            userFriendLists(this.apiBaseUrl, query)\n                .then(response => {\n                    if (response.code !== 0) {\n                        return false;\n                    }\n                    let data = response.data;\n                    if (data.length <= 0) {\n                        return false;\n                    }\n                    let userFriendList = Object.assign({}, this.userFriendList);\n                    for (let item of data) {\n                        // 聊过天\n                        if (item.lastMsgContent) {\n                            this.pushHistoryMsg(\n                                1,\n                                item.user.uid,\n                                item.remark || item.user.name,\n                                item.user.remark,\n                                item.user.avatar,\n                                item.lastMsgContent,\n                                item.unMsgCount,\n                                item.modifiedTime\n                            );\n                        }\n                        userFriendList[item.friendUid] = item;\n                    }\n                    this.userFriendList = userFriendList;\n                    if (data.length < limit) {\n                        return false;\n                    }\n                    this.getUserFriendList(page + 1, limit);\n                })\n                .catch(() => {});\n        },\n        // 朋友列表的点击\n        friendClick(item) {\n            let data = {\n                type: 1,\n                id: item.friendUid,\n                name: item.remark ? item.remark : item.user.name,\n                avatar: item.user.avatar,\n                remark: item.user.remark,\n                unMsgCount: item.unMsgCount ? item.unMsgCount : 0\n            };\n            this.handleChat(data);\n        },\n        // 新的朋友点击\n        newFriendClick() {\n            if (!this.newFriendVisible) {\n                this.newFriendQuery.page = 1;\n                this.newFriendVisible = true;\n                this.newFriendLoadMore = true;\n                this.newFriendList = [];\n                this.getUserFriendAskList();\n                // 清空\n                if (this.user.profile.friendAskCount > 0) {\n                    this.clearFriendAskCount();\n                }\n                return false;\n            }\n            this.newFriendVisible = false;\n        },\n        // 发送好友请求\n        createUserFriendAsk(checkCode, remark) {\n            userFriendAskCreate(this.apiBaseUrl, checkCode, remark)\n                .then(response => {\n                    if (response.code) {\n                        return false;\n                    }\n                })\n                .catch(() => {});\n        },\n        // 确认\n        askAck(item, status) {\n            userFriendAskAck(this.apiBaseUrl, item.id, status)\n                .then(response => {\n                    if (response.code) {\n                        return false;\n                    }\n                    item.status = status;\n                    let userFriendList = Object.assign({}, this.userFriendList);\n                    userFriendList[item.friendUid] = item;\n                    this.userFriendList = userFriendList;\n                    // 追加到历史消息\n                    this.pushHistoryMsg(\n                        1,\n                        item.user.uid,\n                        item.user.name,\n                        item.user.remark,\n                        item.user.avatar,\n                        item.remark ? item.remark : \"成为好友，现在开始聊吧~\",\n                        0,\n                        new Date()\n                    );\n                })\n                .catch(() => {});\n        },\n        // 清空好友请求数量\n        clearFriendAskCount() {\n            userFriendAskClearFriendAskCount(this.apiBaseUrl)\n                .then(response => {\n                    if (response.code) {\n                        return false;\n                    }\n                    this.user.profile.friendAskCount = 0;\n                })\n                .catch(() => {});\n        },\n        // 获取好友请求列表\n        getUserFriendAskList() {\n            if (!this.newFriendLoadMore || this.newFriendLoading) {\n                return false;\n            }\n            this.newFriendLoading = true;\n            userFriendAskLists(this.apiBaseUrl, this.newFriendQuery)\n                .then(response => {\n                    this.newFriendLoading = false;\n                    if (response.code) {\n                        this.newFriendLoadMore = true;\n                        return false;\n                    }\n                    this.newFriendQuery.page += 1;\n                    let data = response.data;\n                    if (data.length === 0) {\n                        this.newFriendLoadMore = false;\n                        return false;\n                    }\n                    if (data.length < this.newFriendQuery.limit) {\n                        this.newFriendLoadMore = false;\n                    }\n                    this.newFriendList = this.newFriendList.concat(data);\n                })\n                .catch(() => {\n                    this.newFriendLoading = false;\n                });\n        },\n        // 获取群列表\n        getUserGroupList(page, limit) {\n            let query = {\n                page: page,\n                limit: limit\n            };\n            userGroupUserLists(this.apiBaseUrl, query)\n                .then(response => {\n                    if (response.code !== 0) {\n                        return false;\n                    }\n                    let data = response.data;\n                    if (data.length <= 0) {\n                        return false;\n                    }\n                    let userGroupList = Object.assign({}, this.userGroupList);\n                    for (let item of data) {\n                        // 聊过天\n                        if (item.lastMsgContent) {\n                            this.pushHistoryMsg(\n                                2,\n                                item.groupId,\n                                item.remark || item.group.name,\n                                item.group.remark,\n                                item.group.avatar,\n                                item.lastMsgContent,\n                                item.unMsgCount,\n                                item.lastMsgTime\n                            );\n                        }\n                        userGroupList[item.groupId] = item;\n                    }\n                    this.userGroupList = userGroupList;\n                    if (data.length < limit) {\n                        return false;\n                    }\n                    this.getUserGroupList(page + 1, limit);\n                })\n                .catch(() => {});\n        },\n        // 群组列表的点击\n        groupClick(item) {\n            let data = {\n                type: 2,\n                id: item.groupId,\n                name: item.group.name,\n                avatar: item.group.avatar,\n                remark: item.group.remark\n            };\n            this.handleChat(data);\n        },\n        // 创建群\n        createGroup() {\n            this.createGroupVisible = true;\n            if (this.createGroupName.length === 0) {\n                return false;\n            }\n            userGroupCreate(this.apiBaseUrl, this.createGroupName, \"\", \"\")\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    let data = response.data;\n                    let userGroupList = Object.assign({}, this.userGroupList);\n                    let item = {\n                        groupId: data.groupId,\n                        group: data\n                    };\n                    userGroupList[item.groupId] = item;\n                    this.userGroupList = userGroupList;\n                    this.createGroupVisible = false;\n                    this.createGroupName = \"\";\n                    // 默认打开群聊天界面\n                    let chatData = {\n                        type: 2,\n                        id: item.groupId,\n                        name: item.group.name,\n                        avatar: item.group.avatar,\n                        remark: item.group.remark\n                    };\n                    this.handleChat(chatData);\n                })\n                .catch(() => {});\n        },\n        // 取消创建群\n        createGroupClose() {\n            this.createGroupVisible = false;\n        },\n        // 加入群\n        joinGroupUser(checkCode) {\n            userGroupUserCreate(this.apiBaseUrl, checkCode)\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    let item = response.data;\n\n                    let userGroupList = Object.assign({}, this.userGroupList);\n                    this.pushHistoryMsg(\n                        2,\n                        item.groupId,\n                        item.remark || item.group.name,\n                        item.group.remark,\n                        item.group.avatar,\n                        item.lastMsgContent,\n                        1,\n                        item.lastMsgTime\n                    );\n                    userGroupList[item.groupId] = item;\n                    this.userGroupList = userGroupList;\n                })\n                .catch(() => {});\n        },\n        // 修改在群的信息\n        updateGroupUser(groupId, remark) {\n            userGroupUserUpdate(this.apiBaseUrl, groupId, remark)\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                })\n                .catch(() => {});\n        },\n        // 删除/退出群\n        outGroupUser(groupId) {\n            userGroupUserDelete(this.apiBaseUrl, groupId)\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    let item = response.data;\n\n                    let userGroupList = Object.assign({}, this.userGroupList);\n                    delete userGroupList[item.groupId];\n                    this.userGroupList = userGroupList;\n                    let historyMsgList = Object.assign({}, this.historyMsgList);\n                    delete historyMsgList[2 + \"-\" + item.groupId];\n                    this.historyMsgList = historyMsgList;\n                })\n                .catch(() => {});\n        },\n        isShowGroupUserListClick() {\n            this.chatMsgGroupUserVisible = !this.chatMsgGroupUserVisible;\n            if (\n                !this.chatMsgGroupUserVisible ||\n                Object.keys(this.chatMsgGroupUserList).length > 0\n            ) {\n                return false;\n            }\n            let query = {\n                groupId: this.historyMsgListSelected.id,\n                page: 1,\n                limit: 500\n            };\n            userGroupLists(this.apiBaseUrl, query)\n                .then(response => {\n                    if (response.code !== 0) {\n                        this.requestErr(response.code, response.message);\n                        return false;\n                    }\n                    let data = response.data;\n                    let chatMsgGroupUserList = Object.assign(\n                        {},\n                        this.chatMsgGroupUserList\n                    );\n                    for (let item of data) {\n                        chatMsgGroupUserList[item.user.uid] = item;\n                    }\n                    this.chatMsgGroupUserList = chatMsgGroupUserList;\n                })\n                .catch(() => {});\n        },\n        // 追加历史消息 (type: 1:好友,2:群消息)\n        pushHistoryMsg(\n            type,\n            id,\n            name,\n            remark,\n            avatar,\n            lastMsgContent,\n            unMsgCount,\n            modifiedTime\n        ) {\n            let key = type + \"-\" + id;\n            let map = Object.assign({}, this.historyMsgList);\n            let item = map[key];\n            console.log(item, key, \"历史消息\");\n            if (item) {\n                item.lastMsgContent = lastMsgContent;\n                item.unMsgCount += unMsgCount;\n                item.modifiedTime = modifiedTime;\n                map[key] = item;\n                this.historyMsgList = map;\n                return false;\n            }\n            let data = {\n                id: id,\n                type: type,\n                name: name,\n                remark: remark,\n                avatar: avatar,\n                lastMsgContent: lastMsgContent,\n                unMsgCount: unMsgCount,\n                modifiedTime: modifiedTime\n            };\n            map[key] = data;\n            this.historyMsgList = map;\n        },\n        // 追加消息到当前聊天 {isLoad：是否加载更多}\n        pushChatMsgList(msgType, msgContent, user, createTime, isLoad) {\n            msgContent = this.createContent(msgContent);\n            createTime = this.formatDate(createTime, \"yyyy/MM/dd hh:mm:ss\");\n            let item = {};\n            item.isMine = this.user.uid === user.uid;\n            item.user = user;\n            item.msgType = msgType;\n            item.msgContent = msgContent;\n            item.createTime = createTime;\n            // 加载更多，向头部增加\n            if (isLoad) {\n                this.chatMsgList.unshift(item);\n            } else {\n                // 头部尾部增加\n                this.chatMsgList.push(item);\n            }\n        },\n        // 断开连接时\n        webSocketClose() {\n            // 修改状态为未连接\n            this.webSocketIsOpen = false;\n            this.webSocket = null;\n            // 判断是否重连\n            if (\n                this.webSocketIsReconnect &&\n                this.webSocketReconnectCount === 0\n            ) {\n                // 第一次直接尝试重连\n                this.webSocketReconnect();\n            }\n        },\n        // 定时心跳\n        webSocketPing() {\n            this.webSocketPingTimer = setTimeout(() => {\n                if (!this.webSocketIsOpen) {\n                    return false;\n                }\n                console.log(\"心跳\");\n                const payload = {\n                    type: 0\n                };\n                this.webSocketSend(payload);\n                clearTimeout(this.webSocketPingTimer);\n                // 重新执行\n                this.webSocketPing();\n            }, this.webSocketPingTime);\n        },\n        // 初始化 WebSocket\n        webSocketInit() {\n            this.webSocketWarningText =\n                \"连接断开,正在尝试重连 <i class='dotting'></i>\";\n            // 修改是否重连为 true\n            this.webSocketIsReconnect = true;\n            this.webSocket = new WebSocket(this.webSocketUrl);\n            this.webSocket.onopen = this.webSocketHandleOpen;\n            this.webSocket.onerror = this.webSocketHandleError;\n            this.webSocket.onmessage = this.webSocketHandleMessage;\n            this.webSocket.onclose = this.webSocketHandleClose;\n        },\n        // WebSocket 重连\n        webSocketReconnect() {\n            if (this.webSocketIsOpen) {\n                return false;\n            }\n            this.webSocketReconnectCount += 1;\n            // 判断是否到了最大重连次数\n            if (\n                this.webSocketReconnectCount >= this.webSocketReconnectMaxCount\n            ) {\n                this.webSocketWarningText = \"重连次数超限\";\n                return false;\n            }\n            // 初始化\n            this.webSocketInit();\n\n            // 每过 5 秒尝试一次，检查是否连接成功，直到超过最大重连次数\n            let timer = setTimeout(() => {\n                this.webSocketReconnect();\n                clearTimeout(timer);\n            }, 5000);\n        },\n        // WebSocket 打开成功后\n        webSocketHandleOpen() {\n            console.log(\"连接打开\");\n            this.webSocketIsOpen = true;\n            // 清空重连的次数\n            this.webSocketReconnectCount = 0;\n            // 发送登录信息\n            const payload = {\n                type: 1\n            };\n            this.webSocketSend(payload);\n            // 开启定时心跳\n            this.webSocketPing();\n        },\n        // WebSocket 关闭\n        webSocketHandleClose() {\n            console.log(\"连接断开\");\n            // 关闭心跳\n            this.webSocketClose();\n        },\n        // WebSocket 发生错误时\n        webSocketHandleError(err) {\n            console.log(\"连接报错：\", err);\n            // 关闭心跳\n            this.webSocketClose();\n        },\n        // 接收到消息时\n        webSocketHandleMessage(event) {\n            // 响应体的message\n            const data = event.data;\n            this.WSResDecode(data, response => {\n                console.log(\"服务端消息:\", response);\n                let type = response.type || 0;\n                switch (type) {\n                    case -2: // 登录异常\n                        // 退出登录\n                        this.userOut();\n                        break;\n                    case -1: // 异地登录\n                        // 通知下线\n                        this.wsOut();\n                        break;\n                    case 1: // 好友消息\n                        this.wsFriendMsgHandle(response);\n                        break;\n                    case 2: // 群消息\n                    case 5: // 加入群消息\n                        this.wsGroupMsgHandle(response);\n                        break;\n                    case 3: // 好友请求\n                        this.wsFriendAskHandle();\n                        break;\n                    case 4: // 好友同意消息\n                        this.wsFriendAckHandle(response);\n                        break;\n                }\n            });\n        },\n        wsOut() {\n            this.webSocketWarningText = \"异地登录请重新登录\";\n            // 修改重连状态\n            this.webSocketIsReconnect = false;\n            if (this.webSocket) {\n                console.log(\"关闭websocket\");\n                // 关闭 websocket\n                this.webSocket.close();\n            }\n        },\n        // 好友请求\n        wsFriendAskHandle() {\n            this.user.profile.friendAskCount += 1;\n        },\n        // 好友同意消息\n        wsFriendAckHandle(response) {\n            let message = response.message;\n            let user = response.user;\n            let createTime = new Date(response.createTime);\n            let receiveId = message.receiveId || 0;\n            let uid = user.uid || 0;\n            let msgContent = message.msgContent || \"\";\n            if (\n                !receiveId ||\n                typeof receiveId !== \"number\" ||\n                receiveId === 0 ||\n                !msgContent ||\n                msgContent === \"\" ||\n                typeof uid !== \"number\" ||\n                uid === 0\n            ) {\n                return false;\n            }\n            let userFriendList = Object.assign({}, this.userFriendList);\n            let userFriendItem = {\n                friendUid: uid,\n                user: user\n            };\n            userFriendList[uid] = userFriendItem;\n            this.userFriendList = userFriendList;\n            let historyType = 1; // 好友\n            let unMsgCount = 1;\n            // 追加到历史消息\n            this.pushHistoryMsg(\n                historyType,\n                uid,\n                user.name,\n                user.remark,\n                user.avatar,\n                msgContent,\n                unMsgCount,\n                createTime\n            );\n        },\n        // 消息类型的消息（好友消息）\n        wsFriendMsgHandle(response) {\n            let message = response.message;\n            let user = response.user;\n            let createTime = new Date(response.createTime);\n            let receiveId = message.receiveId || 0;\n            let uid = user.uid || 0;\n            let msgType = message.msgType || 0;\n            let msgContent = message.msgContent || \"\";\n            console.log(\"好友消息\", receiveId, msgContent, uid);\n            if (\n                !receiveId ||\n                typeof receiveId !== \"number\" ||\n                receiveId === 0 ||\n                !msgContent ||\n                msgContent === \"\" ||\n                typeof uid !== \"number\" ||\n                uid === 0\n            ) {\n                return false;\n            }\n            let name = user.name;\n            let remark = user.remark;\n            let avatar = user.avatar;\n            // 判断是不是打开的这个对象\n            let selectedType = this.historyMsgListSelected.type || 0;\n            let id = this.historyMsgListSelected.id || 0;\n            let unMsgCount = 1;\n            let historyType = 1;\n            // 判断是不是聊天窗口的消息\n            if (selectedType === historyType && id === uid) {\n                let user = {\n                    uid: uid,\n                    name: name,\n                    avatar: avatar\n                };\n                this.pushChatMsgList(msgType, msgContent, user, createTime);\n                unMsgCount = 0;\n                // 如果超过 1 个消息，则做一次 ACK 消息的操作\n                this.chatCount += 1;\n                if (this.chatCount >= this.chatMaxCount) {\n                    this.chatCount = 0;\n                    // 清空消息\n                    this.msgClearUnMsgCount(historyType, id);\n                }\n            }\n            this.pushHistoryMsg(\n                historyType,\n                uid,\n                name,\n                remark,\n                avatar,\n                msgContent,\n                unMsgCount,\n                createTime\n            );\n        },\n        // 消息类型的消息（群消息）\n        wsGroupMsgHandle(response) {\n            let type = response.type;\n            let message = response.message;\n            let user = response.user;\n            let createTime = new Date(response.createTime);\n            let receiveId = message.receiveId || 0;\n            let uid = user.uid || 0;\n            let msgType = message.msgType || 0;\n            let msgContent = message.msgContent || \"\";\n            console.log(\"群消息\", receiveId, msgContent, uid);\n            if (\n                !receiveId ||\n                typeof receiveId !== \"number\" ||\n                receiveId === 0 ||\n                !msgContent ||\n                msgContent === \"\" ||\n                typeof uid !== \"number\" ||\n                uid === 0\n            ) {\n                return false;\n            }\n            // 如果是入群消息, 则改变\n            let isJoinGroup = false;\n            if (type === 5) {\n                isJoinGroup = true;\n            }\n            let name = user.name;\n            let remark = user.remark;\n            let avatar = user.avatar;\n            // 判断是不是打开的这个对象\n            let selectedType = this.historyMsgListSelected.type || 0;\n            let id = this.historyMsgListSelected.id || 0;\n            let unMsgCount = 1;\n            let historyType = 2;\n            // 判断是不是聊天窗口的消息\n            if (selectedType === historyType && id === receiveId) {\n                let user = {\n                    uid: uid,\n                    name: name,\n                    avatar: avatar\n                };\n                this.pushChatMsgList(msgType, msgContent, user, createTime);\n                unMsgCount = 0;\n                // 如果超过 多少 个消息，则做一次 ACK 消息的操作\n                this.chatCount += 1;\n                if (this.chatCount >= this.chatMaxCount) {\n                    this.chatCount = 0;\n                    // 清空消息\n                    this.msgClearUnMsgCount(historyType, id);\n                }\n                // 入群消息\n                if (isJoinGroup) {\n                    let chatMsgGroupUserList = Object.assign(\n                        {},\n                        this.chatMsgGroupUserList\n                    );\n                    chatMsgGroupUserList[user.uid] = user;\n                    this.chatMsgGroupUserList = chatMsgGroupUserList;\n                }\n            }\n            let groupItem = this.userGroupList[receiveId];\n            name = groupItem.group ? groupItem.group.name : \"gd\" + receiveId;\n            remark = groupItem.group ? groupItem.group.remark : \"\";\n            avatar = groupItem.group ? groupItem.group.avatar : \"\";\n            this.pushHistoryMsg(\n                historyType,\n                receiveId,\n                name,\n                remark,\n                avatar,\n                msgContent,\n                unMsgCount,\n                createTime\n            );\n        },\n        // 发送ws消息\n        webSocketSend(payload) {\n            // 加入登录验证\n            payload.uid = parseInt(this.getUid());\n            payload.sid = this.getSid();\n            let buffer = this.WSResEncode(payload);\n            this.webSocket.send(buffer);\n        },\n        // 发送按钮点击\n        sendBtnClick() {\n            if (\n                !this.chatText ||\n                this.chatText === \"\" ||\n                /^[ ]+$/.test(this.chatText)\n            ) {\n                return false;\n            }\n            let item = this.historyMsgListSelected;\n            let msgType = 0; // 文本消息\n            if (item.type === 1) {\n                // 发送\n                let postData = {\n                    receiverUid: item.id,\n                    msgType: msgType,\n                    msgContent: this.chatText\n                };\n                userFriendMsgCreate(this.apiBaseUrl, postData)\n                    .then(response => {\n                        if (response.code !== 0) {\n                            this.requestErr(response.code, response.message);\n                            return false;\n                        }\n                        this.receiveMessage(\n                            item.type,\n                            item.id,\n                            item.name,\n                            item.remark,\n                            item.avatar,\n                            msgType,\n                            this.user,\n                            this.chatText,\n                            new Date()\n                        );\n                        this.chatText = \"\";\n                    })\n                    .catch(() => {});\n                return false;\n            }\n            if (item.type === 2) {\n                let postData = {\n                    groupId: item.id,\n                    msgType: msgType,\n                    msgContent: this.chatText\n                };\n                userGroupMsgCreate(this.apiBaseUrl, postData)\n                    .then(response => {\n                        if (response.code !== 0) {\n                            this.requestErr(response.code, response.message);\n                            return false;\n                        }\n                        this.receiveMessage(\n                            item.type,\n                            item.id,\n                            item.name,\n                            item.remark,\n                            item.avatar,\n                            msgType,\n                            this.user,\n                            this.chatText,\n                            new Date()\n                        );\n                        this.chatText = \"\";\n                    })\n                    .catch(() => {});\n                return false;\n            }\n        },\n        // 接收消息的追加\n        receiveMessage(\n            type,\n            id,\n            name,\n            remark,\n            avatar,\n            msgType,\n            user,\n            msgContent,\n            createTime\n        ) {\n            // 是否自动滚动到底部\n            this.chatMsgListScrollTop = true;\n            let data = {};\n            data.isMine = this.user.uid === user.uid;\n            if (this.historyMsgListSelected !== null) {\n                data.msgType = msgType;\n                data.user = user;\n                data.msgContent = this.createContent(msgContent);\n                data.createTime = this.formatDate(\n                    createTime,\n                    \"yyyy/MM/dd hh:mm:ss\"\n                );\n                this.chatMsgList.push(data);\n            }\n\n            let lastMsgContent = msgContent;\n            switch (msgType) {\n                case 1:\n                    lastMsgContent = \"[图片消息]\";\n                    break;\n                case 2:\n                    lastMsgContent = \"[文件消息]\";\n                    break;\n                case 3:\n                    lastMsgContent = \"[语言消息]\";\n                    break;\n                case 4:\n                    lastMsgContent = \"[视频消息]\";\n                    break;\n            }\n            let unMsgCount = data.isMine ? 0 : 1;\n            // 更新最后一次接收的消息\n            this.pushHistoryMsg(\n                type,\n                id,\n                name,\n                remark,\n                avatar,\n                lastMsgContent,\n                unMsgCount,\n                createTime\n            );\n        },\n        // 格式化文本消息, 这里主要做表情的筛选\n        createContent(text) {\n            if (typeof text === \"string\") {\n                text = this.htmlSpecialChars(text);\n                let html = text\n                    /* eslint-disable */\n                    .replace(/:emoji\\[([^\\s\\[\\]]+?)\\]/g, function(emoji) {\n                        // 转义表情\n                        var emojiId = \"emoji_\" + emoji.replace(/^:emoji/g, \"\");\n                        return document.getElementById(emojiId).innerHTML + \"&nbsp;\";\n                    })\n                    .replace(/\\n/g, \"<br>\");\n                return html;\n            }\n            return text;\n        },\n        getDate(dateStr) {\n            let date = new Date(dateStr);\n            if (isNaN(date.getDate())) {\n                // 说明有可能是手机端, 做一下处理\n                dateStr = dateStr.replace(/T/g, ' ');\n                dateStr = dateStr.replace(/-/g, '/');\n                dateStr = dateStr.replace(/\\.\\d+/, ' ');\n                date = new Date(dateStr);\n                // 如果还是转换不了\n                if (isNaN(date.getDate())) {\n                    return null;\n                }\n            }\n            return date;\n        },\n        // 日期的格式化\n        formatDate(dateStr, fmt) {\n            if (!dateStr) {\n                return \"\";\n            }\n            let date = this.getDate(dateStr);\n            if (!date) {\n                return \"\";\n            }\n            if (!fmt) {\n                fmt = \"yyyy-MM-dd\";\n            }\n            const o = {\n                \"M+\": date.getMonth() + 1, //月份\n                \"d+\": date.getDate(), //日\n                \"h+\": date.getHours(), //小时\n                \"m+\": date.getMinutes(), //分\n                \"s+\": date.getSeconds(), //秒\n                \"q+\": Math.floor((date.getMonth() + 3) / 3), //季度\n                S: date.getMilliseconds() //毫秒\n            };\n            if (/(y+)/.test(fmt))\n                fmt = fmt.replace(\n                    RegExp.$1,\n                    (date.getFullYear() + \"\").substr(4 - RegExp.$1.length)\n                );\n            for (let k in o)\n                if (new RegExp(\"(\" + k + \")\").test(fmt))\n                    fmt = fmt.replace(\n                        RegExp.$1,\n                        RegExp.$1.length === 1\n                            ? o[k]\n                            : (\"00\" + o[k]).substr((\"\" + o[k]).length)\n                    );\n            return fmt;\n        },\n        htmlSpecialChars(str) {\n            str = str.replace(/&/g, \"&amp;\");\n            str = str.replace(/</g, \"&lt;\");\n            str = str.replace(/>/g, \"&gt;\");\n            str = str.replace(/\"/g, \"&quot;\");\n            str = str.replace(/'/g, \"&#039;\");\n            return str;\n        },\n        // 弹出浏览器通知\n        notification(id, title, content, icon) {\n            var Notification =\n                window.Notification ||\n                window.mozNotification ||\n                window.webkitNotification;\n            // 判断浏览器是否支持桌面通知\n            if (Notification && Notification.permission === \"granted\") {\n                let notification = new Notification(title, {\n                    body: content,\n                    icon: icon\n                });\n                notification.onclick = (() => {\n                    // 点击了通知消息\n                    notification.close();\n                });\n            }\n        },\n        // 主面板的移动\n        moveImBox(e) {\n            // let ele = e.target;\n            //算出鼠标相对元素的位置\n            const _this = this;\n            // let disX = e.clientX - ele.offsetLeft;\n            // let disY = e.clientY - ele.offsetTop;\n            let disX = e.clientX - this.$refs.imBox.offsetLeft;\n            let disY = e.clientY - this.$refs.imBox.offsetTop;\n            _this.isMove = true;\n            document.onmousemove = (e)=>{\n                //鼠标按下并移动的事件\n                //用鼠标的位置减去鼠标相对元素的位置，得到元素的位置\n                let left = e.clientX - disX;\n                let top = e.clientY - disY;\n\n                //绑定元素位置到positionX和positionY上面\n                _this.imBoxPositionY = left + 'px';\n                _this.imBoxPositionX = top + 'px';\n\n            };\n            document.onmouseup = (e) => {\n                _this.isMove = false;\n                document.onmousemove = null;\n                document.onmouseup = null;\n            };\n        },\n        // 聊天界面的移动\n        moveChatMsg(e) {\n            // let ele = e.target;\n            //算出鼠标相对元素的位置\n            const _this = this;\n            // let disX = e.clientX - ele.offsetLeft;\n            // let disY = e.clientY - ele.offsetTop;\n            let disX = e.clientX - this.$refs.imChatBox.offsetLeft;\n            let disY = e.clientY - this.$refs.imChatBox.offsetTop;\n            let disW = this.$refs.imChatBox.clientWidth;\n            let disH = this.$refs.imChatBox.clientHeight;\n            _this.isMove = true;\n            document.onmousemove = (e)=>{\n                // 鼠标按下并移动的事件\n                // 用鼠标的位置减去鼠标相对元素的位置，得到元素的位置\n                let left = e.clientX - disX;\n                let top = e.clientY - disY;\n                // 判断是否到了临界值, 因为用了 transform: translate(-50%, -50%); 所以要除 2\n                if ((top > (disH / 2)) && ((_this.clientHeight - top) > (disH / 2))) {\n                    _this.chatMsgListPositionX = top + 'px';\n                }\n                if ((left > (disW / 2)) && ((_this.clientWidth - left) > (disW / 2))) {\n                    _this.chatMsgListPositionY = left + 'px';\n                }\n            };\n            document.onmouseup = (e) => {\n                _this.isMove = false;\n                document.onmousemove = null;\n                document.onmouseup = null;\n            };\n        }\n    },\n    directives: {\n        focus: {\n            update(el, { value }) {\n                if (value) {\n                    el.focus();\n                }\n            }\n        }\n    },\n    filters: {\n        getDefaultAvatar(avatar) {\n            if (avatar === null || avatar === \"\" || avatar === \"\") {\n                return \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWAgMAAABBb5lxAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURUxpcfDw8OPj4+Dg4FOJnTQAAAABdFJOUwBA5thmAAABUElEQVRYw+3Yy22EMBAGYDpLFUMOPlCCS3AVrmNLYJugBB9yy4UDKwHJhhj5Mdj/slYekn3+NPJ4PGNB87ICq2kQtV4x9l5ZZZVV9hvsjdpLnk30ufosG+6sy7HlrqjNsfGLkcqwYWMyw/TGXtNs21q8uYDN34zSbLKsT7LRMoUxmWQGY4NlXQmmLRM/yKwKi3qO6aLR/jJ7NFOB3RBR4iKZB5kq0Vlgny5Y1y8EjRpbBoHNty7DDDYGwaE6s4meneQrex5nn48tVZllI5fowdOmsGh90WiqVKbguWFVAEuP3TfwPQX7dJ9IbYrt3Ux0STBNBwPOY06woPwe0y4TR2wmbx0x4zPJs8VX3pk4bAyYG85hOmSCYxNFq2eYiZlkWKyc27mzhWEUs4ljfcRGjsmIDU+wrrJCzGBVYEuvInZjVFu/ASurrLL/y64N9sv6AwiKosleKgwtAAAAAElFTkSuQmCC\";\n            }\n            return avatar;\n        },\n        askAckStatusFilterName(index) {\n            const map = {\n                0: \"确认\",\n                1: \"已添加\",\n                2: \"已拒绝\"\n            };\n            return map[index];\n        }\n    },\n    mounted() {\n        // 获取浏览器可视区域高度\n        this.clientHeight = `${document.documentElement.clientHeight}`;\n        this.clientWidth = `${document.documentElement.clientWidth}`;\n\n        this.__resizeHandler = () => {\n            this.clientHeight = `${document.documentElement.clientHeight}`;\n            this.clientWidth = `${document.documentElement.clientWidth}`;\n        };\n\n        // 添加事件\n        window.addEventListener(\"resize\", this.__resizeHandler);\n    },\n    // 组件销毁\n    beforeDestroy() {\n        // 移除事件\n        window.removeEventListener(\"resize\", this.__resizeHandler);\n    },\n    created() {\n        // 判断是否自动初始化\n        if (this.isAutoInit) {\n            this.init();\n        }\n    },\n    computed: {\n        imBoxStyle () {\n            let data = {};\n            if (this.width) {\n                data.width = this.width;\n            }\n            if (this.height) {\n                data.height = this.height;\n            }\n            if (this.top) {\n                data.top = this.top;\n            }\n            if (this.left) {\n                data.left = this.left;\n            }\n            if (this.bottom) {\n                data.bottom = this.bottom;\n            }\n            if (this.right) {\n                data.right = this.right;\n            }\n            if (this.imBoxPositionX && this.isShow) {\n                data.top = this.imBoxPositionX;\n            }\n            if (this.imBoxPositionY && this.isShow) {\n                data.left = this.imBoxPositionY;\n            }\n            data = {\n                ...data,\n                ...this.themeSelected\n            };\n            return data;\n        },\n        imChatBoxStyle () {\n            let data = {};\n            data = {\n                top: this.chatMsgListPositionX,\n                left: this.chatMsgListPositionY,\n                ...this.themeSelected\n            };\n            return data;\n        },\n        sortHistoryMsgList: function () {\n            let historyMsgList = [];\n            let historyMsgListKeys = Object.keys(this.historyMsgList)\n                .sort((a, b) => {\n                    let aItem = this.historyMsgList[a];\n                    let bItem = this.historyMsgList[b];\n                    let aDate = this.getDate(aItem.modifiedTime);\n                    if (!aDate) {\n                        return -1;\n                    }\n                    let bDate = this.getDate(bItem.modifiedTime);\n                    if (!bDate) {\n                        return 1;\n                    }\n                    return bDate.getTime() - aDate.getTime();\n                })\n                .map((v) => {\n                    historyMsgList.push(this.historyMsgList[v]);\n                });\n            return historyMsgList;\n        }\n    },\n    watch: {\n        chatMsgList() {\n            const _this = this;\n            this.$nextTick(function(){\n                let chatMsgList = document.getElementById(\"chatMsgList\");\n                if (_this.chatMsgListScrollTop) {\n                    chatMsgList.scrollTop = chatMsgList.scrollHeight;\n                }\n            });\n        }\n    },\n    // 组件销毁时触发\n    destroyed() {\n        // 关闭 websocket 链接\n        this.wsOut();\n    }\n};\n</script>\n\n<style type=\"text/scss\" lang=\"scss\">\nbody,\nhtml {\n    height: 100%;\n    font-family: \"Helvetica Neue\", Helvetica, Arial, \"Hiragino Sans GB\",\n    \"Microsoft YaHei\", sans-serif;\n    font-size: 14px;\n}\n*,\n::before,\n::after {\n    /*选择所有标签*/\n    margin: 0;\n    padding: 0;\n    /*清除移动端默认的点击高亮效果*/\n    -webkit-tap-highlight-color: rgba(255, 255, 255, 0);\n    /*设置所有的元素都是以边框开始计算宽度的 百分比*/\n    box-sizing: border-box;\n}\na img {\n    border: 0;\n}\na {\n    text-decoration: none;\n    &:hover {\n        text-decoration: none;\n    }\n}\nul,\nol {\n    list-style: none;\n}\n\ninput {\n    border: none;\n    outline: none;\n    /*清除移动端默认的表单样式*/\n    -webkit-appearance: none;\n}\n//清除浮动\n@mixin clearfix() {\n    &:before,\n    &:after {\n        content: \" \";\n        display: table;\n    }\n    &:after {\n        clear: both;\n    }\n}\n//截断文本  元素必须是 block 或 inline-block 级。\n@mixin text-overflow() {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n.im-box {\n    position: fixed;\n    width: 100%;\n    height: 100%;\n    /*border: 1px solid rgba(0, 0, 0, 0.05);*/\n    /*border-radius: 5px;*/\n    box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.15);\n    transition: transform .3s ease;\n    transform: translate3d(0,100%,0);\n    border: 1px solid rgba(0, 0, 0, 0.05);\n}\n.im-move {\n    position: fixed;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    cursor: move;\n    opacity: 0;\n    filter: alpha(opacity=0);\n    background-color: #fff;\n    z-index: 2147483647;\n}\n.im-box-show {\n    transform: translateZ(0);\n}\n.im-icon {\n    cursor: pointer;\n    background-size: 44px auto;\n    background-image: url(image/im-icon.png);\n    background-repeat: no-repeat;\n}\n@media only screen and (-webkit-min-device-pixel-ratio: 2),\nonly screen and (min--moz-device-pixel-ratio: 2),\nonly screen and (-o-min-device-pixel-ratio: 2/1),\nonly screen and (min-device-pixel-ratio: 2) {\n    .im-icon {\n        background-image: url(image/im-icon@2x.png);\n    }\n}\n.im-icon-ring-open {\n    background-position: -22px -89px;\n}\n.im-icon-panel-down {\n    background-position: -22px -66px;\n}\n.im-icon-close {\n    background-position: 0 -130px;\n}\n.im-icon-emoji {\n    background-position: 0 0;\n}\n.im-icon-photo {\n    background-position: 0 -22px;\n}\n.im-icon-upload {\n    background-position: 0 -440px;\n}\n.im-icon-ring-open,\n.im-icon-close,\n.im-icon-emoji,\n.im-icon-photo,\n.im-icon-upload,\n.im-icon-panel-down {\n    display: inline-block;\n    width: 22px;\n    height: 22px;\n}\n.im-box-move {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 10px;\n    cursor: move;\n    z-index: 999;\n}\n.im-panel-header {\n    position: relative;\n    background-color: rgba(230, 230, 230, 0.7);\n    color: #fff;\n    height: 80px;\n    padding: 7px 10px;\n    zoom: 1;\n    font-size: 16px;\n    box-shadow: 0 1px 0 0 rgba(0, 0, 0, 0.06), 0 2px 0 0 rgba(0, 0, 0, 0.01);\n    overflow: hidden;\n    .im-header-user {\n        padding-left: 8px;\n        margin-top: 12px;\n        display: flex;\n        align-items: center;\n        .im-header-user-avatar {\n            flex: 0 0 auto;\n            display: inline-block;\n            width: 52px;\n            height: 52px;\n            border-radius: 50%;\n        }\n        .im-header-user-content {\n            margin-left: 8px;\n            overflow: hidden;\n        }\n        .im-header-user-name {\n            margin-top: 1px;\n            color: #000;\n            @include text-overflow;\n        }\n        .im-header-user-remark {\n            margin-top: 1px;\n            font-size: 13px;\n            color: rgba(0,0,0,0.6);\n            @include text-overflow;\n        }\n    }\n    .im-header-out-login {\n        display: inline-block;\n        width: 22px;\n        height: 22px;\n        cursor: pointer;\n    }\n    .im-header-qrcode-box {\n        display: inline-block;\n        width: 22px;\n        height: 22px;\n        cursor: pointer;\n    }\n    .im-header-setwin {\n        position: absolute;\n        top: 5px;\n        right: 5px;\n    }\n}\n.im-box-confirm-box {\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.5);\n    z-index: 999;\n    text-align: center;\n    .im-box-confirm {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate3d(-50%,-50%,0);\n        background-color: #fff;\n        width: 85%;\n        border-radius: 3px;\n        font-size: 16px;\n        overflow: hidden;\n        backface-visibility: hidden;\n        transition: .2s;\n    }\n    .im-box-confirm-header {\n        padding: 15px 0 0;\n    }\n    .im-box-confirm-title {\n        text-align: center;\n        padding-left: 0;\n        margin-bottom: 0;\n        font-size: 16px;\n        font-weight: 700;\n        color: #333;\n    }\n    .im-box-confirm-content {\n        padding: 10px 20px 15px;\n        border-bottom: 1px solid #ddd;\n        min-height: 36px;\n        position: relative;\n    }\n    .im-box-confirm-message {\n        color: #999;\n        margin: 0;\n        text-align: center;\n        line-height: 36px;\n    }\n    .im-box-confirm-buttons {\n        display: flex;\n        height: 40px;\n        line-height: 40px;\n    }\n    .im-box-confirm-button {\n        line-height: 35px;\n        display: block;\n        background-color: #fff;\n        flex: 1;\n        margin: 0;\n        border: 0;\n        cursor: pointer;\n    }\n    .im-box-confirm-cancel {\n        width: 50%;\n        border-right: 1px solid #ddd;\n    }\n    .im-box-confirm-ok {\n        color: #26a2ff;\n        width: 50%;\n    }\n}\n.user-qrcode-box {\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.5);\n    z-index: 999;\n    .user-qrcode {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        z-index: 1000;\n    }\n    .user-qrcode-download {\n        cursor: pointer;\n        height: 50px;\n        line-height: 50px;\n        text-align: center;\n        color: #fff;\n    }\n    .user-uid {\n        height: 50px;\n        line-height: 50px;\n        text-align: center;\n        color: #fff;\n    }\n}\n.user-login-box {\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.9);\n    z-index: 999;\n    .user-login-list {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        z-index: 1000;\n        display: flex;\n    }\n    .user-login-button:first-child {\n        margin-left: 0;\n    }\n    .user-login-button {\n        display: inline-block;\n        margin-left: 20px;\n        cursor: pointer;\n        text-align: center;\n        img {\n            width: 50px;\n            height: 50px;\n        }\n        span {\n            display: block;\n            color: #ffffff;\n        }\n        &:hover {\n            opacity: 0.7;\n        }\n    }\n}\n.group-qrcode-box {\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.5);\n    z-index: 999;\n    .group-qrcode {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        z-index: 1000;\n    }\n    .group-qrcode-download {\n        cursor: pointer;\n        height: 50px;\n        line-height: 50px;\n        text-align: center;\n        color: #fff;\n    }\n    .group-id {\n        height: 50px;\n        line-height: 50px;\n        text-align: center;\n        color: #fff;\n    }\n}\n.im-tab-nav {\n    background-color: rgba(230, 230, 230, 0.7);\n}\n.im-tab {\n    cursor: pointer;\n    width: 100%;\n    height: 42px;\n    line-height: 42px;\n    .im-tab-item {\n        position: relative;\n        display: inline-block;\n        text-align: center;\n        width: 33.33%;\n        height: 100%;\n        &:hover {\n            opacity: 0.5;\n        }\n    }\n    .im-tab-item-selected::after {\n        content: '';\n        position: absolute;\n        left: 0;\n        bottom: 0;\n        width: 100%;\n        height: 3px;\n        background-color: #3FDD86;\n    }\n    .im-tab-badge {\n        position: absolute;\n        top: 4px;\n        right: 10px;\n        background-color: #f56c6c;\n        border-radius: 10px;\n        color: #fff;\n        display: inline-block;\n        font-size: 12px;\n        height: 19px;\n        line-height: 19px;\n        padding: 0 5px;\n        text-align: center;\n        white-space: nowrap;\n        border: 1px solid #fff;\n    }\n}\n.im-list-empty {\n    width: 100%;\n    height: 50px;\n    line-height: 50px;\n    text-align: center;\n    color: #999;\n}\n.im-panel-body {\n    position: absolute;\n    top: 122px;\n    bottom: 30px;\n    right: 0;\n    left: 0;\n    width: 100%;\n    background-color: #fcfcfc;\n    overflow-x: hidden;\n    overflow-y: scroll;\n    background-color: rgba(255, 255, 255, 0.9);\n}\n.im-group-create {\n    height: 40px;\n    color: green;\n    text-align: center;\n    border-bottom: 1px solid rgba(0, 0, 0, 0.04);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding-right: 10px;\n    padding-left: 10px;\n    input {\n        height: 25px;\n        padding: 2px 5px;\n        flex: 2;\n        border: 1px solid rgba(0, 0, 0, 0.04);\n    }\n    .im-group-create-button {\n        cursor: pointer;\n        height: 100%;\n        line-height: 40px;\n        flex: 1;\n    }\n}\n.im-new-friend {\n    height: 40px;\n    line-height: 40px;\n    border-bottom: 1px solid rgba(0, 0, 0, 0.04);\n    padding-right: 50px;\n    padding-left: 10px;\n    cursor: pointer;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    &:hover {\n        background-color: rgba(0, 0, 0, 0.05);\n    }\n}\n.im-new-friend-list-more {\n    width: 100%;\n    height: 30px;\n    line-height: 30px;\n    text-align: center;\n}\n.im-panel-searchbar {\n    position: relative;\n    background-color: #f8f8f8;\n    box-sizing: border-box;\n    padding: 5px 7px;\n    z-index: 1;\n}\n.im-panel-searchbar-inner {\n    position: relative;\n    height: 28px;\n    padding-left: 25px;\n    background-color: #fff;\n    border-radius: 3px;\n}\n.im-panel-search {\n    position: absolute;\n    left: 10px;\n    top: 8px;\n    width: 13px;\n    vertical-align: middle;\n    line-height: 28px;\n}\n.im-panel-searchbar-core {\n    appearance: none;\n    border: 0;\n    box-sizing: border-box;\n    width: 100%;\n    height: 100%;\n    outline: 0;\n    outline-offset: -2px;\n    vertical-align: middle;\n    border-top-right-radius: 3px;\n    border-bottom-right-radius: 3px;\n}\n.im-panel-user-list {\n    li {\n        position: relative;\n        /*padding: 0 0 0 15px;*/\n        padding-left: 12px;\n        /*height: 65px;*/\n        cursor: pointer;\n        display: flex;\n        overflow: hidden;\n        align-items: center;\n    }\n    li:hover {\n        background-color: rgba(0, 0, 0, 0.05);\n    }\n    .im-user-left {\n        width: 52px;\n        height: 52px;\n    }\n    .im-user-right {\n        position: relative;\n        padding: 18px 0;\n        /*height: 100%;*/\n        border-bottom: 1px solid rgba(0, 0, 0, 0.04);\n    }\n    .im-user-avatar {\n        display: inline-block;\n        width: 52px;\n        height: 52px;\n        border-radius: 26px;\n        box-shadow: 0 3px 3px 0 rgba(0, 0, 0, 0.1);\n        vertical-align: middle;\n    }\n    .im-user-info {\n        display: inline-block;\n        height: 100%;\n        margin-left: 10px;\n        vertical-align: middle;\n    }\n    .im-user-name {\n        display: inline-block;\n        margin-bottom: 3px;\n        font-size: 15px;\n        @include text-overflow;\n    }\n    .im-user-remark {\n        display: block;\n        max-width: 200px;\n        margin-top: 3px;\n        font-size: 12px;\n        color: #999;\n        @include text-overflow;\n    }\n    .im-panel-badge {\n        position: absolute;\n        top: 10px;\n        right: 10px;\n        background-color: #f56c6c;\n        border-radius: 10px;\n        color: #fff;\n        display: inline-block;\n        font-size: 12px;\n        height: 19px;\n        line-height: 19px;\n        padding: 0 5px;\n        text-align: center;\n        white-space: nowrap;\n        border: 1px solid #fff;\n    }\n    .im-user-button {\n        position: absolute;\n        top: 10px;\n        right: 10px;\n        height: 50px;\n        line-height: 50px;\n        text-align: center;\n        color: green;\n        span {\n            cursor: pointer;\n        }\n    }\n}\n.im-list-more {\n    display: block;\n    width: 100%;\n    height: 35px;\n    line-height: 35px;\n    text-align: center;\n    font-size: 12px;\n    color: #777;\n    cursor: pointer;\n}\n.im-panel-footer {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    width: 100%;\n    background-color: #f6f6f6;\n    height: 30px;\n    line-height: 30px;\n    padding-left: 10px;\n    padding-right: 10px;\n    font-size: 12px;\n    .im-panel-theme {\n        display: inline-block;\n        width: 25px;\n        height: 25px;\n        vertical-align: middle;\n        cursor: pointer;\n        img {\n            width: 100%;\n            height: 100%;\n        }\n    }\n    .im-panel-theme-list {\n        position: absolute;\n        bottom: 30px;\n        left: 0;\n        width: 100%;\n        height: 140px;\n        border-top: 1px solid #d9d9d9;\n        background-color: #ffffff;\n        padding-top: 10px;\n        padding-left: 10px;\n    }\n    .im-panel-theme-item {\n        padding-bottom: 10px;\n        padding-right: 10px;\n        display: inline-block;\n        width: 33.33%;\n        height: 50%;\n        line-height: 50%;\n        text-align: center;\n        cursor: pointer;\n        div {\n            display: inline-block;\n            width: 100%;\n            height: 100%;\n            background-color: #ccc;\n        }\n    }\n}\n.im-chat-box {\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 600px;\n    height: 522px;\n    z-index: 100;\n    border-radius: 2px;\n    border: 1px solid #D9D9D9;\n    overflow-y: hidden;\n}\n.im-chat-move {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 10px;\n    cursor: move;\n}\n.im-chat-header {\n    position: relative;\n    height: 80px;\n    padding: 18px 12px 12px;\n    /*background-color: #ececec;*/\n    background-color: rgba(230, 230, 230, 0.7);\n    color: #444;\n    box-shadow: 0 1px 0 0 rgba(0, 0, 0, 0.06), 0 2px 0 0 rgba(0, 0, 0, 0.01);\n    border-bottom: 1px solid #eee;\n}\n.im-chat-warning {\n    position: absolute;\n    top: 80px;\n    left: 0;\n    width: 100%;\n    height: 25px;\n    line-height: 25px;\n    color: #e6a26d;\n    font-size: 12px;\n    /*background-color: #fdf6eb;*/\n    background-color: rgba(253, 246, 235, 0.9);\n    text-align: center;\n    z-index: 3;\n    opacity: 0.8;\n}\n.im-user-warning-box {\n    height: 25px;\n    background-color: rgba(0, 0, 0, 0);\n}\n.dotting {\n    position: absolute;\n    top: 12px;\n    display: inline-block;\n    width: 10px;\n    min-height: 2px;\n    padding-right: 2px;\n    border-left: 2px solid currentColor; border-right: 2px solid currentColor;\n    background-color: currentColor; background-clip: content-box;\n    box-sizing: border-box;\n    animation: dotting 2s infinite step-start both;\n    *zoom: expression(this.innerHTML = '...'); /* IE7 */\n}\n.dotting:before { content: '...'; } /* IE8 */\n.dotting::before { content: ''; }\n:root .dotting { margin-left: 2px; padding-left: 2px; } /* IE9+ */\n\n@keyframes dotting {\n    25% { border-color: transparent; background-color: transparent; }          /* 0个点 */\n    50% { border-right-color: transparent; background-color: transparent; }    /* 1个点 */\n    75% { border-right-color: transparent; }                                   /* 2个点 */\n}\n.im-chat-reconnect {\n    width: 100%;\n    height: 20px;\n    line-height: 20px;\n    text-align: center;\n    background-color: #f8f8f8;\n}\n.im-chat-user {\n    cursor: default;\n    display: flex;\n    align-items: center;\n}\n.im-chat-user-avatar {\n    flex: 0 0 auto;\n    display: inline-block;\n    width: 52px;\n    height: 52px;\n    border-radius: 26px;\n    box-shadow: 0 3px 3px 0 rgba(0, 0, 0, 0.1);\n    vertical-align: middle;\n}\n.im-chat-user-info {\n    display: inline-block;\n    margin-left: 10px;\n    vertical-align: middle;\n    overflow: hidden;\n}\n.im-chat-user-name {\n    display: inline-block;\n    max-width: 160px;\n    font-size: 14px;\n    @include text-overflow;\n}\n.im-chat-user-list-button {\n    display: inline-block;\n    overflow: hidden;\n    margin-left: 10px;\n    color: #999;\n}\n.im-chat-user-remark {\n    display: block;\n    font-size: 13px;\n    color: #999;\n    margin-top: 5px;\n    width: 100%;\n    @include text-overflow;\n}\n.im-chat-setwin {\n    position: absolute;\n    right: 10px;\n    top: 10px;\n}\n.im-chat-main {\n    position: absolute;\n    top: 80px;\n    bottom: 140px;\n    width: 100%;\n    padding: 15px 15px 5px;\n    overflow-x: hidden;\n    overflow-y: scroll;\n    background-color: rgba(255, 255, 255, 0.9);\n}\n.im-chat-msg-box {\n    position: relative;\n    width: 100%;\n    margin-bottom: 10px;\n    padding-left: 60px;\n    min-height: 68px;\n    font-size: 0;\n    overflow: hidden;\n}\n.im-chat-msg-emoji {\n    width: 20px;\n    height: 20px;\n    vertical-align: middle;\n}\n.im-chat-msg-mine {\n    text-align: right;\n    padding-left: 0;\n    padding-right: 60px;\n}\n.im-chat-msg-user {\n    display: inline-block;\n    position: absolute;\n    left: 3px;\n    font-size: 14px;\n    vertical-align: top;\n    width: 100%;\n    img {\n        width: 40px;\n        height: 40px;\n        border-radius: 100%;\n    }\n}\n.im-chat-msg-user-remark {\n    position: absolute;\n    left: 60px;\n    top: -2px;\n    line-height: 24px;\n    font-size: 12px;\n    color: #999;\n    text-align: left;\n    span {\n        display: inline-block;\n        vertical-align: middle;\n        max-width: 170px;\n        @include text-overflow();\n    }\n    i {\n        display: inline-block;\n        vertical-align: middle;\n        padding-left: 15px;\n        font-style: normal;\n    }\n}\n.im-chat-msg-text {\n    position: relative;\n    display: inline-block;\n    line-height: 22px;\n    margin-top: 25px;\n    padding: 8px 15px;\n    background-color: #e2e2e2;\n    border-radius: 3px;\n    color: #333;\n    word-break: break-all;\n    font-size: 14px;\n    img {\n        max-width: 100%;\n        vertical-align: middle;\n    }\n}\n.im-chat-msg-text::after {\n    content: \"\";\n    position: absolute;\n    left: -10px;\n    top: 13px;\n    width: 0;\n    height: 0;\n    border-style: solid dashed dashed;\n    border-color: #e2e2e2 transparent transparent;\n    overflow: hidden;\n    border-width: 10px;\n}\n.im-chat-msg-mine .im-chat-msg-text::after {\n    left: auto;\n    right: -10px;\n    border-top-color: #5fb878;\n}\n.im-chat-msg-mine {\n    .im-chat-msg-user {\n        left: auto;\n        right: 3px;\n    }\n    .im-chat-msg-user-remark {\n        left: auto;\n        right: 60px;\n        text-align: right;\n        i {\n            padding-left: 0;\n            padding-right: 15px;\n        }\n    }\n    .im-chat-msg-text {\n        margin-left: 0;\n        text-align: left;\n        background-color: #5fb878;\n        /*background-color: rgba(255, 255, 255, 0.9);*/\n        color: #fff;\n    }\n}\n.im-chat-footer {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    width: 100%;\n    height: 140px;\n    /*background-color: #fff;*/\n    background-color: rgba(255, 255, 255, 0.9);\n    box-shadow: 0 -1px 0 0 rgba(0, 0, 0, 0.04), 0 -2px 0 0 rgba(0, 0, 0, 0.01);\n}\n.im-chat-feature-holder {\n    /*height: 40px;*/\n}\n.im-chat-feature-btn-box {\n    padding-top: 7px;\n    padding-bottom: 3px;\n}\n.im-emoji-box {\n    position: relative;\n}\n.im-emoji-holder {\n    position: absolute;\n    /*display: none;*/\n    top: -130px;\n    left: -10px;\n    right: 0;\n    z-index: 101;\n    width: 320px;\n    height: 120px;\n    padding: 10px;\n    border: 1px solid #d9d9d9;\n    background-color: #fff;\n    box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);\n}\n.im-emoji-control {\n    background-image: url(image/emoji.png);\n    background-size: 25px auto;\n    background-repeat: no-repeat;\n    display: block;\n    float: left;\n    width: 25px;\n    height: 25px;\n    margin-top: 6px;\n    margin-left: 7px;\n    cursor: pointer;\n}\n@media only screen and (-webkit-min-device-pixel-ratio: 2),\nonly screen and (min--moz-device-pixel-ratio: 2),\nonly screen and (-o-min-device-pixel-ratio: 2/1),\nonly screen and (min-device-pixel-ratio: 2) {\n    .im-emoji-control {\n        background-image: url(image/emoji@2x.png);\n    }\n}\n.im-chat-feature-btn {\n    cursor: pointer;\n    margin-left: 12px;\n}\n.im-chat-text-holder {\n    textarea {\n        display: block;\n        width: 100%;\n        height: 65px;\n        padding: 8px 10px;\n        overflow-x: hidden;\n        overflow-y: auto;\n        resize: none;\n        outline: 0;\n        background: 0 0;\n        border: 0;\n        word-break: break-all;\n        font-size: 13px;\n        line-height: 17px;\n        -webkit-appearance: none;\n    }\n}\n.im-chat-send-box {\n    position: relative;\n    height: 45px;\n}\n.im-chat-send {\n    position: absolute;\n    right: 15px;\n    top: 3px;\n    height: 32px;\n    line-height: 32px;\n    background: 0 0;\n}\n.im-chat-send-btn {\n    background: 0 0;\n    cursor: pointer;\n    display: inline-block;\n    vertical-align: top;\n    font-size: 14px;\n    line-height: 28px;\n    margin-left: 5px;\n    padding: 0 20px;\n    background-color: #5fb878;\n    color: #fff;\n    border-radius: 3px;\n}\n.im-chat-user-list {\n    position: absolute;\n    top: 80px;\n    height: 200px;\n    width: 100%;\n    z-index: 4;\n    overflow-y: auto;\n    overflow-x: hidden;\n    border: 1px solid #D9D9D9;\n    background-color: rgba(255,255,255,.9);\n    .im-chat-user-list-item {\n        display: inline-block;\n        width: 20%;\n        height: 70px;\n        text-align: center;\n        margin: 15px 0;\n        cursor: pointer;\n        &:hover {\n            opacity: 0.9\n        }\n        &:hover cite{\n            text-decoration: underline;\n        }\n        img {\n            width: 48px;\n            height: 48px;\n            border-radius: 100%;\n        }\n        cite {\n            display: block;\n            padding: 0 3px;\n            color: #428bca;\n            font-style: normal;\n            @include text-overflow;\n        }\n    }\n}\n@media screen and (max-width: 768px) {\n    .im-box {\n        width: 100% !important;\n        height: 100% !important;\n        border: 0 !important;\n    }\n    .im-panel-body {\n        -webkit-overflow-scrolling: touch;\n    }\n    .im-chat-main {\n        -webkit-overflow-scrolling: touch;\n    }\n    .im-chat-box {\n        width: 100%;\n        height: 100%;\n        border: 0 !important;\n    }\n}\n</style>\n"]}]}